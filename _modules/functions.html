<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>functions &mdash; spectrapepper  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            spectrapepper
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">spectrapepper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributions.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">spectrapepper</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">functions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for functions</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This main module contains all the functions available in spectrapepper. Please</span>
<span class="sd">use the search function to look up specific functionalities and keywords.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">splev</span><span class="p">,</span> <span class="n">splrep</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">butter</span><span class="p">,</span> <span class="n">filtfilt</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">statistics</span> <span class="k">as</span> <span class="nn">sta</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">statistics</span> <span class="k">as</span> <span class="nn">sta</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">linecache</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">load_spectras</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load sample specrtal data, axis included in the first line.</span>

<span class="sd">    :type sample: int, tuple</span>
<span class="sd">    :param sample: Index of the sample spectra wanted or a tuple with the range</span>
<span class="sd">        of the indeces of a groups of spectras.</span>

<span class="sd">    :returns: X axis and the sample spectral data selected.</span>
<span class="sd">    :rtype: list[float], list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;spectras.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">sample</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>


<span class="k">def</span> <span class="nf">load_targets</span><span class="p">(</span><span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load sample targets data for the spectras.</span>
<span class="sd">    </span>
<span class="sd">    :returns: Sample targets.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;targets.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">flatten</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">load_params</span><span class="p">(</span><span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load sample parameters data for the spectras.</span>
<span class="sd">    </span>
<span class="sd">    :returns: Sample parameters.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;params.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">data</span>


<div class="viewcode-block" id="load"><a class="viewcode-back" href="../functions.html#functions.load">[docs]</a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">fromline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">toline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> 
          <span class="n">separators</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;;&quot;</span><span class="p">],</span> <span class="n">blanks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">],</span> <span class="n">replacewith</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load data from a text file obtained from LabSpec and other</span>
<span class="sd">    spectroscopy software. Normally, single measurements come in </span>
<span class="sd">    columns with the first one being the x-axis. When it is a mapping, the</span>
<span class="sd">    first row is the x-axis and the following are the measurements. It can also</span>
<span class="sd">    peroform random access to a particular ´line´ and also it is possibel to define</span>
<span class="sd">    specific range to load with &#39;fromline&#39; and &#39;toline&#39;.</span>
<span class="sd">    </span>
<span class="sd">    :type file: str</span>
<span class="sd">    :param file: Url of data file. Must not have headers and separated by </span>
<span class="sd">        &#39;spaces&#39; (LabSpec).</span>
<span class="sd">    </span>
<span class="sd">    :type fromline: int</span>
<span class="sd">    :param fromline: Line of file from which to start loading data. The default</span>
<span class="sd">        is 0.</span>

<span class="sd">    :type toline: int</span>
<span class="sd">    :param fromline: Line of file to which to end loading data. The default</span>
<span class="sd">        is &#39;None&#39; which idicates the full range of data.</span>
<span class="sd">    </span>
<span class="sd">    :type line: int</span>
<span class="sd">    :param line: Random access to file. Loads a specific line in a file. Default</span>
<span class="sd">        is ´None´.</span>
<span class="sd">    </span>
<span class="sd">    :type transpose: boolean</span>
<span class="sd">    :param transpose: If True transposes the data. Default is False.</span>
<span class="sd">    </span>
<span class="sd">    :type dtype: str</span>
<span class="sd">    :param dtype: Type of data. If its numeric then &#39;float&#39;, if text then &#39;string&#39;.</span>
<span class="sd">        Default is &#39;float&#39;.</span>
<span class="sd">        </span>
<span class="sd">    :returns: List of the data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">process_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">separators</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">blanks</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">replacewith</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">raw_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">linecache</span><span class="o">.</span><span class="n">getline</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">process_row</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw_data</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">fromline</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">toline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">toline</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">s_row</span> <span class="o">=</span> <span class="n">process_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
                    <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_row</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_data</span></div>


<div class="viewcode-block" id="lowpass"><a class="viewcode-back" href="../functions.html#functions.lowpass">[docs]</a><span class="k">def</span> <span class="nf">lowpass</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nyq</span><span class="o">=</span><span class="mf">0.75</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Butter low pass filter for a single or spectra or a list of them.</span>
<span class="sd">        </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of vectors in line format (each line is a vector).</span>
<span class="sd">    </span>
<span class="sd">    :type cutoff: float</span>
<span class="sd">    :param cutoff: Desired cutoff frequency of the filter. The default is 0.25.</span>
<span class="sd">    </span>
<span class="sd">    :type fs: int</span>
<span class="sd">    :param fs: Sample rate in Hz. The default is 30.</span>
<span class="sd">    </span>
<span class="sd">    :type order: int</span>
<span class="sd">    :param order: Sin wave can be approx represented as quadratic. The default is 2.</span>
<span class="sd">    </span>
<span class="sd">    :type nyq: float</span>
<span class="sd">    :param nyq: Nyquist frequency, 0.75*fs is a good value to start. The default is 0.75*30.</span>

<span class="sd">    :returns: Filtered data</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># so it does not change the input list</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
    
    <span class="n">normal_cutoff</span> <span class="o">=</span> <span class="n">cutoff</span> <span class="o">/</span> <span class="p">(</span><span class="n">nyq</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">butter</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">normal_cutoff</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="normtomax"><a class="viewcode-back" href="../functions.html#functions.normtomax">[docs]</a><span class="k">def</span> <span class="nf">normtomax</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zeromin</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes spectra to the maximum value of each, in other words, the</span>
<span class="sd">    maximum value of each spectra is set to the specified value.</span>

<span class="sd">    :type y: list[float], numpy.ndarray</span>
<span class="sd">    :param y: Single or multiple vectors to normalize.</span>

<span class="sd">    :type to: float</span>
<span class="sd">    :param to: value to which normalize to. Default is 1.</span>

<span class="sd">    :type zeromin: boolean</span>
<span class="sd">    :param zeromin: If `True`, the minimum value is translated to 0. Default</span>
<span class="sd">        value is `False`</span>

<span class="sd">    :returns: Normalized data.</span>
<span class="sd">    :rtype: list[float], numpy.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">zeromin</span><span class="p">:</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">to</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="normtovalue"><a class="viewcode-back" href="../functions.html#functions.normtovalue">[docs]</a><span class="k">def</span> <span class="nf">normtovalue</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes the spectras to a set value, in other words, the defined value</span>
<span class="sd">    will be reescaled to 1 in all the spectras.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Single or multiple vectors to normalize.</span>

<span class="sd">    :type val: float</span>
<span class="sd">    :param val: Value to normalize to.</span>

<span class="sd">    :returns: Normalized data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">val</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="alsbaseline"><a class="viewcode-back" href="../functions.html#functions.alsbaseline">[docs]</a><span class="k">def</span> <span class="nf">alsbaseline</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of the baseline using Asymmetric Least Squares Smoothing. This</span>
<span class="sd">    script only makes the calculation but it does not remove it. Original idea of</span>
<span class="sd">    this algorithm by P. Eilers and H. Boelens (2005):</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Spectra to calculate the baseline from.</span>

<span class="sd">    :type lam: int</span>
<span class="sd">    :param lam: Lambda, smoothness. The default is 100.</span>

<span class="sd">    :type p: float</span>
<span class="sd">    :param p: Asymmetry. The default is 0.001.</span>

<span class="sd">    :type niter: int</span>
<span class="sd">    :param niter: Niter. The default is 10.</span>

<span class="sd">    :type remove: True</span>
<span class="sd">    :param remove: If `True`, calculates and returns `data - baseline`. If </span>
<span class="sd">        `False`, then it returns the `baseline`.</span>

<span class="sd">    :returns: Returns the calculated baseline.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
    
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    
    <span class="n">resolve</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">W</span> <span class="o">+</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">d</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>       
            <span class="n">z</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">w</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">)</span>
        <span class="c1"># y[i] = y[i] - z</span>
        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="n">resolve</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resolve</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">resolve</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">resolve</span></div>


<div class="viewcode-block" id="bspbaseline"><a class="viewcode-back" href="../functions.html#functions.bspbaseline">[docs]</a><span class="k">def</span> <span class="nf">bspbaseline</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">avg</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcuates the baseline using b-spline.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Single or several spectras to remove the baseline from.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis of the data, to interpolate the baseline function.</span>

<span class="sd">    :type points: list[float], list[[float, float]]</span>
<span class="sd">    :param points: Axis values of points to calculate the bspline. Axis ranges</span>
<span class="sd">        are also acepted. In this case, the `avg` value will be `0`.</span>

<span class="sd">    :type avg: int</span>
<span class="sd">    :param avg: Points to each side to make average. Default is 5. If `points`</span>
<span class="sd">        are axis ranges, then it is set to 0 and will not have any effect.</span>

<span class="sd">    :type remove: True</span>
<span class="sd">    :param remove: If `True`, calculates and returns `data - baseline`. If </span>
<span class="sd">        `False`, then it returns the `baseline`.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True, calculates and returns (data - baseline).    </span>

<span class="sd">    :returns: The baseline.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">]</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    
    <span class="n">baseline</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">y_p</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">avg</span><span class="p">:</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">y_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">spl</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">y_p</span><span class="p">)</span>
        <span class="n">baseline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splev</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">spl</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">baseline</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1">#sometime this happends when doing preprocesing</span>
            <span class="n">baseline</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">baseline</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
        
        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">baseline</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">baseline</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>        
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">baseline</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Baseline&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">y_p</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="polybaseline"><a class="viewcode-back" href="../functions.html#functions.polybaseline">[docs]</a><span class="k">def</span> <span class="nf">polybaseline</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">avg</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcuates the baseline using polynomial fit.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Single or several spectras to remove the baseline from.</span>

<span class="sd">    :type axis: list[float]</span>
<span class="sd">    :param axis: x axis of the data, to interpolate the baseline function.</span>

<span class="sd">    :type points: list[int]</span>
<span class="sd">    :param points: positions in axis of points to calculate baseline.</span>

<span class="sd">    :type deg: int</span>
<span class="sd">    :param deg: Polynomial degree of the fit.</span>

<span class="sd">    :type avg: int</span>
<span class="sd">    :param avg: points to each side to make average.</span>

<span class="sd">    :type remove: True</span>
<span class="sd">    :param remove: if True, calculates and returns (y - baseline).</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: if True, calculates and returns (y - baseline).    </span>

<span class="sd">    :returns: The baseline.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
    
    <span class="n">baseline</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">averages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)):</span>
            <span class="n">averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">avg</span><span class="p">:</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                    
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">averages</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span>  <span class="c1"># polinomial fit</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># 1d polinomial</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>        
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">fit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">averages</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="n">baseline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">fit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">baseline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="n">baseline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">baseline</span></div>


<div class="viewcode-block" id="valtoind"><a class="viewcode-back" href="../functions.html#functions.valtoind">[docs]</a><span class="k">def</span> <span class="nf">valtoind</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To translate the value in an axis to its index in the axis, basically</span>
<span class="sd">    searches for the position of the value. It approximates to the closest.</span>

<span class="sd">    :type vals: list[float]</span>
<span class="sd">    :param vals: List of values to be searched and translated.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: Axis.</span>

<span class="sd">    :returns: Index, or position, in the axis of the values in vals</span>
<span class="sd">    :rtype: list[int], int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">x_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">vals_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">shape_dim</span> <span class="o">=</span> <span class="n">vals_np</span><span class="o">.</span><span class="n">ndim</span>
    
    <span class="k">if</span> <span class="n">shape_dim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x_np</span> <span class="o">-</span> <span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val_row</span><span class="p">]</span> <span class="k">for</span> <span class="n">val_row</span> <span class="ow">in</span> <span class="n">vals_np</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">shape_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x_np</span> <span class="o">-</span> <span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals_np</span><span class="p">]</span>
        <span class="n">vals</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_np</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">shape_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x_np</span> <span class="o">-</span> <span class="n">vals_np</span><span class="p">))</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">x_np</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">pos</span></div>


<div class="viewcode-block" id="areacalculator"><a class="viewcode-back" href="../functions.html#functions.areacalculator">[docs]</a><span class="k">def</span> <span class="nf">areacalculator</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Area calculator using the data (x_data) and the limits in position, not</span>
<span class="sd">    values.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to calculate area from.</span>
<span class="sd">    </span>
<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: X axis of the data.</span>

<span class="sd">    :type limits: list[int]</span>
<span class="sd">    :param limits: Limits that define the areas to be calculated. Axis value.</span>

<span class="sd">    :type norm: bool</span>
<span class="sd">    :param norm: If True, normalized the area to the sum under all the curve.</span>

<span class="sd">    :returns: A list of areas according to the requested limits.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>

    <span class="n">limits</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="n">limits</span><span class="p">]</span>

    <span class="n">areas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">limits</span><span class="p">)))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">limits</span><span class="p">):</span>
        <span class="n">areas</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Normalize if necessary</span>
    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
        <span class="n">areas</span> <span class="o">/=</span> <span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">areas</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>


<div class="viewcode-block" id="bincombs"><a class="viewcode-back" href="../functions.html#functions.bincombs">[docs]</a><span class="k">def</span> <span class="nf">bincombs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s_max</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns all possible unique combinations.</span>

<span class="sd">    :type n: int</span>
<span class="sd">    :param n: Amount of positions.</span>

<span class="sd">    :type s_min: int</span>
<span class="sd">    :param s_min: Minimum amount of 1s.</span>

<span class="sd">    :type s_max: int</span>
<span class="sd">    :param s_max: Maximum amount of 1s.</span>

<span class="sd">    :returns: List of unique combinations.</span>
<span class="sd">    :rtype: list[tuple]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s_max</span><span class="p">)</span>
    <span class="n">s_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s_min</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">s_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">s_max</span> <span class="o">=</span> <span class="n">n</span>

    <span class="n">iters</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># final matrix</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># temp matrix</span>
    <span class="n">stuff</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># matrix of ALL combinations</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># create possibilities vector (0 and 1)</span>
        <span class="n">stuff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">stuff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>  <span class="c1"># get ALL combinations possible from &quot;stuff&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)):</span>  <span class="c1"># for all the possibilities...</span>
        <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iters</span><span class="p">)):</span>  <span class="c1"># check if it already exists</span>
            <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">iters</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>  <span class="c1"># if it matches, add 1</span>
                <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">+=</span> <span class="mi">0</span>  <span class="c1"># if not, add 0</span>
        <span class="c1"># e == 0 and sum(temp[i]) &gt;= s_min and sum(temp[i]) &lt;= s_max</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">s_min</span> <span class="o">&lt;=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">s_max</span><span class="p">:</span>
            <span class="n">iters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># if new and fall into the criteria, then add</span>

    <span class="k">return</span> <span class="n">iters</span></div>


<div class="viewcode-block" id="normsum"><a class="viewcode-back" href="../functions.html#functions.normsum">[docs]</a><span class="k">def</span> <span class="nf">normsum</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes the sum under the curve to 1, for single or multiple spectras.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Single spectra or a list of them to normalize.</span>

<span class="sd">    :type lims: list[float, float]</span>
<span class="sd">    :param lims: Limits of the vector to normalize the sum. Default is `None`.</span>
<span class="sd">        For example, if ´lims = [N, M]´, the the sum under the curve betwween</span>
<span class="sd">        N and M is normalized to 1.</span>

<span class="sd">    :returns: Normalized data</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">lims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">lims</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">s</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="normtoratio"><a class="viewcode-back" href="../functions.html#functions.normtoratio">[docs]</a><span class="k">def</span> <span class="nf">normtoratio</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes a peak to the ratio value respect to another. That is, the peak</span>
<span class="sd">    found in the range of r1 is normalized to the ratio r1/(r1+r2).</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Single spectra or a list of them.</span>

<span class="sd">    :type r1: list[float, float]</span>
<span class="sd">    :param r1: Range of the first area according to the axis.</span>
<span class="sd">        </span>
<span class="sd">    :type r2: list[float, float]</span>
<span class="sd">    :param r2: Range of the second area according to the axis.</span>
<span class="sd">        </span>
<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: Axis of the data. If `None` then it goes from 0 to N, where</span>
<span class="sd">        N is the length of the spectras.</span>

<span class="sd">    :returns: Normalized data</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">a1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">a1</span><span class="o">/</span><span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ratio</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">/</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">m</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">y</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>


<div class="viewcode-block" id="normtoglobalmax"><a class="viewcode-back" href="../functions.html#functions.normtoglobalmax">[docs]</a><span class="k">def</span> <span class="nf">normtoglobalmax</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">globalmin</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes a list of spectras to the global max.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of spectras.</span>

<span class="sd">    :type globalmin: Bool</span>
<span class="sd">    :param globalmin: If `True`, the global minimum is reescaled to 0. Default</span>
<span class="sd">        is `False`.</span>

<span class="sd">    :returns: Normalized data</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># y_min, y_max = y.min(), y.max()</span>
        <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">globalmin</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_min</span>
            <span class="n">y_max</span> <span class="o">-=</span> <span class="n">y_min</span> 
        <span class="c1"># y /= y_max</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">y_max</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">globalmin</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_min</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">y_max</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="normtoglobalsum"><a class="viewcode-back" href="../functions.html#functions.normtoglobalsum">[docs]</a><span class="k">def</span> <span class="nf">normtoglobalsum</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes a list of spectras to the global max sum under the curve. In </span>
<span class="sd">        other words, looks to the largest sum under the curve and sets it to 1,</span>
<span class="sd">        then the other areas are scaled in relation to that one.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of spectras.</span>

<span class="sd">    :returns: Normalized data</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sums</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">maxsum</span> <span class="o">=</span> <span class="n">sums</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">maxsum</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="interpolation"><a class="viewcode-back" href="../functions.html#functions.interpolation">[docs]</a><span class="k">def</span> <span class="nf">interpolation</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolates data to a new axis.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of data to interpolate</span>

<span class="sd">    :type x: list[list[float]]</span>
<span class="sd">    :param x: list of the axises of the data</span>
<span class="sd">    </span>
<span class="sd">    :type step: float</span>
<span class="sd">    :param step: new step for the new axis</span>

<span class="sd">    :returns: Interpolated data and the new axis</span>
<span class="sd">    :rtype: list[float], list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">==</span> <span class="n">finish</span><span class="p">:</span>
        <span class="n">new_start</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">new_end</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">new_end</span> <span class="o">=</span> <span class="n">finish</span>
        
    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">new_start</span><span class="p">:</span>
        <span class="n">new_start</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">new_end</span><span class="p">:</span>
        <span class="n">new_end</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">new_start</span><span class="p">,</span> <span class="n">new_end</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="n">master_y</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>   
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_y</span><span class="p">)):</span>
            <span class="n">this</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">temp_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">master_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this</span><span class="p">(</span><span class="n">x_new</span><span class="p">))</span>            
    <span class="k">else</span><span class="p">:</span>
        <span class="n">this</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">temp_y</span><span class="p">)</span>
        <span class="n">master_y</span> <span class="o">=</span> <span class="n">this</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">master_y</span><span class="p">,</span> <span class="n">x_new</span></div>


<div class="viewcode-block" id="evalgrau"><a class="viewcode-back" href="../functions.html#functions.evalgrau">[docs]</a><span class="k">def</span> <span class="nf">evalgrau</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function evaluates the MSE in 3 dimensions (x,y,z) for a set of</span>
<span class="sd">    data vectors.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: A list of lists of variables to compare.</span>

<span class="sd">    :returns: A list with each combination and the R2 score obtained.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">tup</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>  <span class="c1"># number list of data type sets</span>
    <span class="n">combs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">tup</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># make all combinations</span>
    <span class="n">n_o_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># R2 list</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">combs</span><span class="p">)):</span>  <span class="c1"># for all the combinations</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">combs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># temporal x axis</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">combs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># temporal y axis</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">combs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># temporal z axis</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># fit function parameter</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># fit function parameter</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_o_p</span><span class="p">):</span>  <span class="c1"># for all the data points</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xs</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># A value</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>  <span class="c1"># b value</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># transpose matrix form</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># matrix form</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">I</span> <span class="o">*</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">b</span>  <span class="c1"># evaluate fir</span>
        <span class="n">rss</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># residual sum of squares</span>
        <span class="n">tss</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># total sum of squares</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_o_p</span><span class="p">):</span>  <span class="c1"># calculate mse for all the points</span>
            <span class="n">rss</span> <span class="o">+=</span> <span class="p">(</span><span class="n">zs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">fit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">fit</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># residual sum</span>
            <span class="n">tss</span> <span class="o">+=</span> <span class="p">(</span><span class="n">zs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">zs</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># total error</span>
        <span class="n">r2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rss</span> <span class="o">/</span> <span class="n">tss</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">combs</span><span class="p">,</span> <span class="n">r2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">merged</span></div>


<div class="viewcode-block" id="groupscores"><a class="viewcode-back" href="../functions.html#functions.groupscores">[docs]</a><span class="k">def</span> <span class="nf">groupscores</span><span class="p">(</span><span class="n">all_targets</span><span class="p">,</span> <span class="n">used_targets</span><span class="p">,</span> <span class="n">predicted_targets</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the individual scores for a ML algorithm (i.e.: LDA, PCA, etc).</span>

<span class="sd">    :type all_targets: list[int]</span>
<span class="sd">    :param all_targets: List of all real targets (making sure all groups are </span>
<span class="sd">        here).</span>

<span class="sd">    :type used_targets: list[int]</span>
<span class="sd">    :param used_targets: Targets to score on.</span>

<span class="sd">    :type predicted_targets: list[int]</span>
<span class="sd">    :param predicted_targets: Prediction of used_targets.</span>

<span class="sd">    :returns: List of scores for each group.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g_count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">all_targets</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))]</span>  <span class="c1"># list to count points per group</span>
    <span class="n">g_scores</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">all_targets</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))]</span>  <span class="c1"># list to store the scores</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g_scores</span><span class="p">)):</span>  <span class="c1"># for all the groups</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predicted_targets</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
            <span class="k">if</span> <span class="n">used_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">g_count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">predicted_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">used_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">g_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g_scores</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">g_count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No data with label (class) &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; where found when calculating group scores. Check if the count is out of bounds or none samples of the class where included in the sample.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">g_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">g_count</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">g_scores</span></div>


<div class="viewcode-block" id="cmscore"><a class="viewcode-back" href="../functions.html#functions.cmscore">[docs]</a><span class="k">def</span> <span class="nf">cmscore</span><span class="p">(</span><span class="n">x_points</span><span class="p">,</span> <span class="n">y_points</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the distance between points and the center of mass (CM) of</span>
<span class="sd">    clusters and sets the prediction to the closest CM. This score may be</span>
<span class="sd">    higher or lower than the algorithm score.</span>

<span class="sd">    :type x_points: list[float]</span>
<span class="sd">    :param x_points: Coordinates of x-axis.</span>

<span class="sd">    :type y_points: list[float]</span>
<span class="sd">    :param y_points: Coordinates of y-axis.</span>

<span class="sd">    :type target: list[int]</span>
<span class="sd">    :param target: Targets of each point.</span>

<span class="sd">    :returns: Score by comparing CM distances. Prediction using CM distances.</span>
<span class="sd">        X-axis coords of ths CMs. Y-axis coords of the Cms.</span>
<span class="sd">    :rtype: list[float, list[int],list[float],list[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span>
    <span class="n">y_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span>
    <span class="n">tar</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">g_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>  <span class="c1"># avg D1</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>  <span class="c1"># avg D2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>  <span class="c1"># N for each group</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># distances</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># predictions</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">y_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">c</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No samples for group &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; were found when calculating the center of mass. Check if limits are out of range or samples of that target are missing.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)):</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">temp3</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
            <span class="n">temp3</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">x_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                          <span class="o">+</span> <span class="p">(</span><span class="n">y_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">temp3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">temp2</span><span class="p">:</span>
                <span class="n">temp2</span> <span class="o">=</span> <span class="n">temp3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">temp1</span> <span class="o">=</span> <span class="n">j</span>

        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">temp1</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">score</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span></div>


<div class="viewcode-block" id="mdscore"><a class="viewcode-back" href="../functions.html#functions.mdscore">[docs]</a><span class="k">def</span> <span class="nf">mdscore</span><span class="p">(</span><span class="n">x_p</span><span class="p">,</span> <span class="n">y_p</span><span class="p">,</span> <span class="n">tar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the distance between points and the median center (MD) of</span>
<span class="sd">    clusters and sets the prediction to the closest MD. This score may be</span>
<span class="sd">    higher or lower than the algorithm score.</span>

<span class="sd">    :type x_p: list[float]</span>
<span class="sd">    :param x_p: Coordinates of x-axis.</span>

<span class="sd">    :type y_p: list[float]</span>
<span class="sd">    :param y_p: Coordinates of y-axis.</span>

<span class="sd">    :type tar: list[int]</span>
<span class="sd">    :param tar: Targets of each point.</span>

<span class="sd">    :returns: Score by comparing MD distances. Prediction using MD distances. </span>
<span class="sd">        X-axis coords of ths CMs. Y-axis coords of the Cms.</span>
<span class="sd">    :rtype: list[float, list[int],list[float],list[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x_p</span><span class="p">)</span>
    <span class="n">y_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y_p</span><span class="p">)</span>
    <span class="n">g_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">tar</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># distances</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># predictions</span>

    <span class="n">x_s</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>
    <span class="n">y_s</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">tar</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">x_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_p</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">y_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_p</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x_s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y_s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)):</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">temp3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
            <span class="n">temp3</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">x_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                          <span class="o">+</span> <span class="p">(</span><span class="n">y_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">temp3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">temp2</span><span class="p">:</span>
                <span class="n">temp2</span> <span class="o">=</span> <span class="n">temp3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">temp1</span> <span class="o">=</span> <span class="n">j</span>

        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">temp1</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">score</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span></div>


<div class="viewcode-block" id="normtopeak"><a class="viewcode-back" href="../functions.html#functions.normtopeak">[docs]</a><span class="k">def</span> <span class="nf">normtopeak</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes the spectras to a particular peak.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to be normalized.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis of the data</span>

<span class="sd">    :type peak: float</span>
<span class="sd">    :param peak: Peak position in x-axis values.</span>

<span class="sd">    :type shift: int</span>
<span class="sd">    :param shift: Range to look for the real peak. The default is 10.</span>

<span class="sd">    :returns: Normalized data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">pos</span> <span class="o">-</span> <span class="n">shift</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="n">shift</span><span class="p">]</span>   
        <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">section</span><span class="p">)</span> 
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="peakfinder"><a class="viewcode-back" href="../functions.html#functions.peakfinder">[docs]</a><span class="k">def</span> <span class="nf">peakfinder</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">look</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the location of the peaks in a single vector.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to find a peak in. Single spectra.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: X axis of the data. If no axis is passed then the axis goes </span>
<span class="sd">        from 0 to N, where N is the length of the spectras. Default is `None`.</span>

<span class="sd">    :type ranges: list[[float, float]]</span>
<span class="sd">    :param ranges: Aproximate ranges of known peaks, if any. If no ranges are </span>
<span class="sd">        known or defined, it will return all the peaks that comply with the </span>
<span class="sd">        `look` criteria. If ranges are defined, it wont use the `look` criteria,</span>
<span class="sd">        but just for the absolute maximum within the range. Default is `None`.</span>

<span class="sd">    :type look: int</span>
<span class="sd">    :param look: Amount of position to each side to decide if it is a local </span>
<span class="sd">        maximum. The default is 10.</span>

<span class="sd">    :returns: A list of the index of the peaks found.</span>
<span class="sd">    :rtype: list[int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>

    <span class="k">if</span> <span class="n">ranges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ranges</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="n">ranges</span><span class="p">]</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">peaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">peaks</span></div>


<div class="viewcode-block" id="confusionmatrix"><a class="viewcode-back" href="../functions.html#functions.confusionmatrix">[docs]</a><span class="k">def</span> <span class="nf">confusionmatrix</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">gn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ndw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmm</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> 
                    <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;cm.png&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates and/or plots the confusion matrix for machine learning algorithm</span>
<span class="sd">    results.</span>

<span class="sd">    :type tt: list[float]</span>
<span class="sd">    :param tt: Real targets.</span>

<span class="sd">    :type tp: list[float]</span>
<span class="sd">    :param tp: Predicted targets.</span>

<span class="sd">    :type plot: boolean</span>
<span class="sd">    :param plot: If true, plots the matrix. The default is False</span>

<span class="sd">    :type gn: list[str]</span>
<span class="sd">    :param gn: Names, or lables , of the classification groups. Default is `None`.</span>

<span class="sd">    :type ndw: bool</span>
<span class="sd">    :param ndw: No data warning. If `True`, it warns about no havingdata to </span>
<span class="sd">        evaluate. Default is True.</span>

<span class="sd">    :type title: str</span>
<span class="sd">    :param title: Name of the matrix. Default is empty.</span>

<span class="sd">    :type cmm: str</span>
<span class="sd">    :param cmm: Nam eof the colormap (matplotlib) to use for the plot. Default</span>
<span class="sd">        is Blue.</span>

<span class="sd">    :type fontsize: int</span>
<span class="sd">    :param fontsize: Font size for the labels. The default is 20.</span>
<span class="sd">    </span>
<span class="sd">    :type figsize: Tuple</span>
<span class="sd">    :param figsize: Size of the image. The default is (12, 15).</span>

<span class="sd">    :type ylabel: str</span>
<span class="sd">    :param ylabel: Label for y axis. Default is `True`.</span>
<span class="sd">    </span>
<span class="sd">    :type xlabel: str</span>
<span class="sd">    :param xlabel: Label for x axis. Default is `Prediction`.</span>
<span class="sd">    </span>
<span class="sd">    :returns: The confusion matrix</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tt</span><span class="p">])</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tp</span><span class="p">])</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">gn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">tt</span><span class="p">,</span> <span class="n">tp</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">group_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gn</span><span class="p">)</span>
    <span class="n">gn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_names</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">cmm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmm</span><span class="p">)</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">gn</span><span class="p">,</span> <span class="n">gn</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="n">gn</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gn</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ndw</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No data with label (class) </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> was found when making the confusion matrix. &#39;</span>
                      <span class="s1">&#39;Check if the count is out of bounds or none samples of the class were included in the sample.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="n">tt</span> <span class="o">==</span> <span class="n">i</span><span class="p">],</span> <span class="n">minlength</span><span class="o">=</span><span class="n">gn</span><span class="p">)</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">plot</span> <span class="ow">or</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmm</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group_names</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group_names</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">group_names</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">group_names</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gn</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gn</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">m</span></div>


<div class="viewcode-block" id="avg"><a class="viewcode-back" href="../functions.html#functions.avg">[docs]</a><span class="k">def</span> <span class="nf">avg</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the average vector from a list of vectors.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of vectors.</span>

<span class="sd">    :returns: The average of the vectors in the list.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># detect dimensions </span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">avg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">avg_data</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">avg_data</span></div>


<div class="viewcode-block" id="sdev"><a class="viewcode-back" href="../functions.html#functions.sdev">[docs]</a><span class="k">def</span> <span class="nf">sdev</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the standard deviation for each bin from a list of vectors.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of vectors.</span>

<span class="sd">    :returns: Standard deviation curve</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">curve_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">curve_std</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">curve_std</span></div>


<div class="viewcode-block" id="median"><a class="viewcode-back" href="../functions.html#functions.median">[docs]</a><span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the median vector of a list of vectors.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of vectors.</span>

<span class="sd">    :returns: median curve</span>
<span class="sd">    :rtype: list[float]    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  
    <span class="n">median</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">median</span></div>


<div class="viewcode-block" id="lorentzfit"><a class="viewcode-back" href="../functions.html#functions.lorentzfit">[docs]</a><span class="k">def</span> <span class="nf">lorentzfit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">look</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits peak as an optimization problem or manual fit for Lorentz distirbution,</span>
<span class="sd">    also known as Cauchy. A curve `y` is only mandatory if the optimixzation is</span>
<span class="sd">    needed (manual=False, default). If no axis &#39;x&#39; is defined, then a default </span>
<span class="sd">    axis is generated for both options.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to fit. Single vector.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis.</span>

<span class="sd">    :type pos: int</span>
<span class="sd">    :param pos: X axis position of the peak.</span>

<span class="sd">    :type look: int</span>
<span class="sd">    :param look: axis positions to look to each side in axis units. The default is 5.</span>

<span class="sd">    :type shift: int</span>
<span class="sd">    :param shift: Possible axis shift of the peak in axis units. The default is 2.</span>

<span class="sd">    :type gamma: float</span>
<span class="sd">    :param gamma: Lorentz fit parameter. The default is 5.</span>
<span class="sd">    </span>
<span class="sd">    :type alpha: float</span>
<span class="sd">    :param alpha: Multiplier of the fitting. The maximum value fo the fitting</span>
<span class="sd">        is proportional to this value, but is not necesarly its value. The</span>
<span class="sd">        default is 1.</span>
<span class="sd">    </span>
<span class="sd">    :type manual: boolean</span>
<span class="sd">    :param manual: If `True`, 1 curve will be generated using the declared </span>
<span class="sd">        parameter `gamma` and perform a manual fit. Default is `False`.</span>

<span class="sd">    :returns: Fitted curve.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>      
    
    <span class="k">if</span> <span class="n">manual</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># if no axis is passed</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gamma</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span><span class="o">/</span><span class="n">gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>            
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># if no axis is passed</span>
            <span class="c1"># ax = [i for i in range(len(y))]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">look</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">look</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">valtoind</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="n">s</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
    
        <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">fit</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="n">ppos</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ax</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ppos</span><span class="o">-</span><span class="n">look</span><span class="p">,</span> <span class="n">ppos</span><span class="o">+</span><span class="n">look</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># for all the points            </span>
                <span class="n">fit</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
                <span class="n">error</span> <span class="o">+=</span> <span class="p">(</span><span class="n">fit</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            
            <span class="k">return</span> <span class="n">error</span><span class="o">**</span><span class="mf">0.5</span>
    
        <span class="k">def</span> <span class="nf">constraint1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>  <span class="c1"># master vector to optimize, initial values</span>
        <span class="n">bnds</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00000001</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">9999999</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">9999</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">s</span><span class="p">]]</span>
        <span class="n">con1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint1</span><span class="p">}</span>
        <span class="n">cons</span> <span class="o">=</span> <span class="p">([</span><span class="n">con1</span><span class="p">])</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">x</span>
        
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">))]</span>
        
    <span class="k">return</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="gaussfit"><a class="viewcode-back" href="../functions.html#functions.gaussfit">[docs]</a><span class="k">def</span> <span class="nf">gaussfit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">look</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">4.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits peak as an optimization problem or manual fit. A curve `y` is only </span>
<span class="sd">    mandatory if the optimixzation is needed (manual=False, default). If no</span>
<span class="sd">    axis &#39;ax&#39; is defined, then a default axis is generated for both options. </span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to fit. Single vector.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis.</span>

<span class="sd">    :type pos: int</span>
<span class="sd">    :param pos: Peak index to fit to.</span>

<span class="sd">    :type look: int</span>
<span class="sd">    :param look: axis positions to look to each side in axis units. The default is 5.</span>

<span class="sd">    :type shift: int</span>
<span class="sd">    :param shift: Possible axis shift of the peak in axis units. The default is 2.</span>
<span class="sd">   </span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :param sigma: Sigma value for Gaussian fit. The default is 4.4.</span>

<span class="sd">    :type alpha: float</span>
<span class="sd">    :param alpha: Multiplier of the fitting and initial value of the optimizer</span>
<span class="sd">        when `manual=False`. The maximum value fo the fitting is proportional</span>
<span class="sd">        to this value, but is not necesarly its value. The default is 1.</span>

<span class="sd">    :type manual: boolean</span>
<span class="sd">    :param manual: If `True`, 1 curve will be generated using the declared </span>
<span class="sd">        parameter `sigma` and perform a manual fit. Default is `False`.</span>

<span class="sd">    :type params: boolean</span>
<span class="sd">    :param params: If `True`, it returns the parameters of the fit in the</span>
<span class="sd">        order of `alpha`, `sigma` and `peak position`. Default is `False`.</span>

<span class="sd">    :returns: Fitted curve.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># from now foreward, x is the variable for the optimization.</span>

    <span class="k">if</span> <span class="n">manual</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># if no axis is passed</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>

        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(((</span><span class="n">i</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>    
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># if no axis is passed</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
            
        <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">valtoind</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">look</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">look</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">k</span>
                
        <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
    
        <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">fit</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ppos</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ax</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ppos</span> <span class="o">-</span> <span class="n">look</span><span class="p">,</span> <span class="n">ppos</span> <span class="o">+</span> <span class="n">look</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># for all the points</span>
                <span class="n">fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(((</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
                <span class="n">error</span> <span class="o">+=</span> <span class="p">(</span><span class="n">fit</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># total error</span>
                
            <span class="k">return</span> <span class="n">error</span><span class="o">**</span><span class="mf">0.5</span>
    
        <span class="k">def</span> <span class="nf">constraint1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>  <span class="c1"># master vector to optimize, initial values</span>
        <span class="n">bnds</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0000001</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">99999</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0000001</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="p">[(</span><span class="n">p</span><span class="o">-</span><span class="n">s</span><span class="p">),</span> <span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">s</span><span class="p">)]]</span>
        <span class="n">con1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint1</span><span class="p">}</span>
        <span class="n">cons</span> <span class="o">=</span> <span class="p">([</span><span class="n">con1</span><span class="p">])</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">x</span>
        
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(((</span><span class="n">ax</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)))))</span>
        
    <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="studentfit"><a class="viewcode-back" href="../functions.html#functions.studentfit">[docs]</a><span class="k">def</span> <span class="nf">studentfit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">look</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits peak as an optimization problem.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to fit. Single vector.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis.</span>

<span class="sd">    :type pos: int</span>
<span class="sd">    :param pos: Peak position to fit, in axis values.</span>

<span class="sd">    :type v: float</span>
<span class="sd">    :param v: Student fit parameter. The default is 0.01.</span>
<span class="sd">    </span>
<span class="sd">    :type alpha: float</span>
<span class="sd">    :param alpha: Multiplier of the fitting. The maximum value fo the fitting</span>
<span class="sd">        is proportional to this value, but is not necesarly its value. The</span>
<span class="sd">        default is 1.</span>

<span class="sd">    :type look: int</span>
<span class="sd">    :param look: axis positions to look to each side in axis units. The default is 5.</span>

<span class="sd">    :type shift: int</span>
<span class="sd">    :param shift: Possible axis shift of the peak in axis units. The default is 2.</span>

<span class="sd">    :type manual: boolean</span>
<span class="sd">    :param manual: If `True`, 1 curve will be generated using the declared </span>
<span class="sd">        parameter `sigma` and perform a manual fit. Default is `False`.</span>

<span class="sd">    :returns: Fitted curve.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># initial guesses</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>      
    <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>    
    
    <span class="k">if</span> <span class="n">manual</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># if no axis is passed</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="mi">10</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>  <span class="c1"># for all the points</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">((</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">v</span>
            <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">d</span><span class="p">))</span>
        
    <span class="k">else</span><span class="p">:</span>        
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">valtoind</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span> <span class="c1"># it only works with this axis, idkw</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">look</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">look</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">s</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">k</span>
    
        <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">fit</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">look</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">look</span><span class="p">):</span>  <span class="c1"># for all the points</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">fit</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
                
                <span class="n">error</span> <span class="o">+=</span> <span class="p">(</span><span class="n">fit</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">return</span> <span class="n">error</span><span class="o">**</span><span class="mf">0.5</span>
    
        <span class="k">def</span> <span class="nf">constraint1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="c1"># return x[0]*x[1]*x[2]</span>
            <span class="k">return</span> <span class="mi">0</span>
            
        
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">pos</span><span class="p">])</span>  <span class="c1"># master vector to optimize, initial values</span>
    
        <span class="n">bnds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">99999</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mi">99</span><span class="p">],</span> <span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="n">s</span><span class="p">]]</span>
        <span class="n">con1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint1</span><span class="p">}</span>
        <span class="n">cons</span> <span class="o">=</span> <span class="p">([</span><span class="n">con1</span><span class="p">])</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">x</span>
    
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>  <span class="c1"># for all the points</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">d</span><span class="p">))</span>
            
    <span class="k">return</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="decbound"><a class="viewcode-back" href="../functions.html#functions.decbound">[docs]</a><span class="k">def</span> <span class="nf">decbound</span><span class="p">(</span><span class="n">x_points</span><span class="p">,</span> <span class="n">y_points</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">divs</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Decision Boundaries.</span>

<span class="sd">    :type x_points: list[float]</span>
<span class="sd">    :param x_points: X coordinates of each point.</span>

<span class="sd">    :type y_points: list[float]</span>
<span class="sd">    :param y_points: Y coordinates of each point.</span>

<span class="sd">    :type groups: list[int]</span>
<span class="sd">    :param groups: List of targets for each point.</span>

<span class="sd">    :type limits: list[float]</span>
<span class="sd">    :param limits: Plot and calculation limits. The default is &#39;None&#39;.</span>

<span class="sd">    :type divs: float</span>
<span class="sd">    :param divs: Resolution. The default is 0.01.</span>

<span class="sd">    :returns: The decision boundaries.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">css</span><span class="p">,</span> <span class="n">cmp</span><span class="p">,</span> <span class="n">cmx</span><span class="p">,</span> <span class="n">cmy</span> <span class="o">=</span> <span class="n">cmscore</span><span class="p">(</span><span class="n">x_points</span><span class="p">,</span> <span class="n">y_points</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>

    <span class="n">divs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">divs</span><span class="p">)</span>  <span class="c1"># step</span>
    
    <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="n">map_x</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">divs</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">divs</span><span class="p">)]</span> 
        <span class="n">map_y</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">divs</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">divs</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">map_x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">limits</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">divs</span><span class="p">)</span>  <span class="c1"># mapping limits</span>
        <span class="n">map_y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span> <span class="o">/</span> <span class="n">divs</span><span class="p">)</span>   

    <span class="n">x_divs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">map_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">map_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># mapping combining &#39;divs&#39; &amp; &#39;lims&#39;</span>
    <span class="n">y_divs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">map_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">map_y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">x_cords</span> <span class="o">=</span> <span class="p">[</span><span class="n">divs</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">map_x</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">map_x</span><span class="p">)))]</span>  <span class="c1"># coordinates</span>
    <span class="n">y_cords</span> <span class="o">=</span> <span class="p">[</span><span class="n">divs</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">map_y</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">map_y</span><span class="p">)))]</span>

    <span class="n">pmap</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_divs</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_divs</span><span class="p">)]</span>  <span class="c1"># matrix</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_cords</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cords</span><span class="p">)):</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="mi">9999999999999999999999999</span>
            <span class="c1"># grad = [] #####</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cmx</span><span class="p">)):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmx</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_cords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">cmy</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_cords</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="c1"># grad.append(d) ####</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">t1</span><span class="p">:</span>
                    <span class="n">t1</span> <span class="o">=</span> <span class="n">d</span>
                    <span class="n">pmap</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
            <span class="c1"># grad = np.array(grad)/sum(grad) #####</span>
            <span class="c1"># pmap[j][i] = 0 ####</span>
            <span class="c1"># for k in range(len(grad)): ####</span>
            <span class="c1">#    pmap[j][i] += len(grad) - (k+1)*grad[k] ###</span>
    <span class="k">return</span> <span class="n">pmap</span></div>


<div class="viewcode-block" id="regression"><a class="viewcode-back" href="../functions.html#functions.regression">[docs]</a><span class="k">def</span> <span class="nf">regression</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs an N dimensional regression.</span>

<span class="sd">    :type target: list[float]</span>
<span class="sd">    :param target: Y-axis values, values to predict.</span>

<span class="sd">    :type variable: list[float]</span>
<span class="sd">    :param variable: X-axis values.</span>

<span class="sd">    :type cov: int</span>
<span class="sd">    :param cov: If 1 is regression with covariance, like spearman. The default is 0.</span>

<span class="sd">    :returns: Prediction of the fitting and the Fitting parameters.</span>
<span class="sd">    :rtype: list[list[float],list[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">master</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cov</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">master</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>  <span class="c1"># array of arrays</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>  <span class="c1"># ascending values</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">])</span>  <span class="c1"># 1st col is 1st var</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">)):</span>  <span class="c1"># for all variables and target</span>
            <span class="n">df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># insert into dataframe</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)])</span>  <span class="c1"># sort ascending</span>
            <span class="n">df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pos</span>  <span class="c1"># translate to position</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>  <span class="c1"># reorder to maintain original position</span>

        <span class="n">master</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="n">A</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># fit function parameter</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>  <span class="c1"># for all the data points</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">)):</span>
            <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># transpose matrix</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">I</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">b</span>  <span class="c1"># evaluate fir</span>

    <span class="n">prediction</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">+=</span> <span class="n">master</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">fit</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="n">fit</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">prediction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="decdensity"><a class="viewcode-back" href="../functions.html#functions.decdensity">[docs]</a><span class="k">def</span> <span class="nf">decdensity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">divs</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">th</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the density decision map from a cluster mapping.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: X coordinates of each point.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Y coordinates of each point.</span>

<span class="sd">    :type groups: list[int]</span>
<span class="sd">    :param groups: List of targets for each point.</span>

<span class="sd">    :type limits: list[float]</span>
<span class="sd">    :param limits: Plot and calculation limits. The default is &#39;None&#39;.</span>

<span class="sd">    :type divs: float</span>
<span class="sd">    :param divs: Resolution ti calculate density. The default is 0.5.</span>

<span class="sd">    :type th: int</span>
<span class="sd">    :param th: Threshold from where a area is defined as a certain group.</span>
<span class="sd">    </span>
<span class="sd">    :returns: The density decision map.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">divs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">divs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="n">map_x</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">divs</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">divs</span><span class="p">)]</span> 
        <span class="n">map_y</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">divs</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">divs</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">map_x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">limits</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">divs</span><span class="p">)</span>  <span class="c1"># mapping limits</span>
        <span class="n">map_y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span> <span class="o">/</span> <span class="n">divs</span><span class="p">)</span>
    
    <span class="n">x_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="n">groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
    <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># number of groups</span>

    <span class="n">x_divs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">map_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">map_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># divisons for mapping</span>
    <span class="n">y_divs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">map_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">map_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">x_cords</span> <span class="o">=</span> <span class="p">[</span><span class="n">divs</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">map_x</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">map_x</span><span class="p">)))]</span>  <span class="c1"># coordinates</span>
    <span class="n">y_cords</span> <span class="o">=</span> <span class="p">[</span><span class="n">divs</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">map_y</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">map_y</span><span class="p">)))]</span>
    
    <span class="n">master</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># to store the maps for each group</span>

    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_groups</span><span class="p">):</span>
        <span class="n">pmap</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_divs</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_divs</span><span class="p">)]</span>  <span class="c1"># individual matrices</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_cords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_p</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x_cords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x_p</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x_cords</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                            <span class="n">y_cords</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y_p</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">y_cords</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                            <span class="n">groups</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">):</span>
                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                        
                <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">th</span><span class="p">:</span>
                    <span class="n">pmap</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pmap</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="n">maximum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No density was found for group &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;. Check if the range is out of bounds or targets with this value are missing.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">pmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span> <span class="o">/</span> <span class="n">maximum</span>
        
        <span class="n">master</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">master</span></div>


<div class="viewcode-block" id="isaxis"><a class="viewcode-back" href="../functions.html#functions.isaxis">[docs]</a><span class="k">def</span> <span class="nf">isaxis</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detects if there is an axis in the data.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data containing spectras an possible axis.</span>

<span class="sd">    :returns: True if there is axis.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">features</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">axis</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span></div>



<div class="viewcode-block" id="trim"><a class="viewcode-back" href="../functions.html#functions.trim">[docs]</a><span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes columns in a list from start to finish.</span>

<span class="sd">    :type y: list</span>
<span class="sd">    :param y: Data to be trimmed.</span>

<span class="sd">    :type start: int, optional</span>
<span class="sd">    :param start: Poistion of the starting point. The default is 0.</span>

<span class="sd">    :type finish: int, optional</span>
<span class="sd">    :param finish: Position of the ending point (not included). The default is 0.</span>

<span class="sd">    :returns: Trimmed data.</span>
<span class="sd">    :rtype: list[]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
    
    <span class="n">final</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">finish</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">finish</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">finish</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">finish</span> <span class="o">-</span> <span class="n">start</span>    

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">j</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   
        <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">final</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="shuffle"><a class="viewcode-back" href="../functions.html#functions.shuffle">[docs]</a><span class="k">def</span> <span class="nf">shuffle</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">delratio</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merges and shuffles data and then separates it so it is shuffles together.</span>

<span class="sd">    :type arrays: list[list[float]]</span>
<span class="sd">    :param arrays: List of arrays of data.</span>

<span class="sd">    :type delratio: float</span>
<span class="sd">    :param delratio: Ratio of the data to be deleted, 0 &lt; delratio &lt; 1</span>

<span class="sd">    :returns: List of the shuffled arrays.</span>
<span class="sd">    :rtype: list[list[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span>
    <span class="n">delratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">delratio</span><span class="p">)</span>

    <span class="n">features</span> <span class="o">=</span> <span class="n">all_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_list</span><span class="p">)):</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">features</span><span class="p">,</span> <span class="n">all_list</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>  <span class="c1"># shuffle data before training the ML</span>

    <span class="k">if</span> <span class="n">delratio</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># to random delete an amount of data</span>

        <span class="n">delnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">delratio</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)))</span>  <span class="c1"># amount to delete</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delnum</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>  <span class="c1"># row to delete</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">new_list</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">all_list</span><span class="p">]</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># if lists are 2d</span>
            <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># save the length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># otherwise is only 1 number</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_list</span><span class="p">)):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
        <span class="n">finish</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">new_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">finish</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">finish</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">new_list</span></div>


<div class="viewcode-block" id="mergedata"><a class="viewcode-back" href="../functions.html#functions.mergedata">[docs]</a><span class="k">def</span> <span class="nf">mergedata</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merges data, it can merge large vectors. Useful to merge features</span>
<span class="sd">    before performing ML algorithms.</span>

<span class="sd">    :type data: list[list[float]]</span>
<span class="sd">    :param data: List of arrays.</span>

<span class="sd">    :returns: List with the merged data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># list of lists</span>
    <span class="n">master</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">master</span></div>


<div class="viewcode-block" id="shiftref"><a class="viewcode-back" href="../functions.html#functions.shiftref">[docs]</a><span class="k">def</span> <span class="nf">shiftref</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">ref_axis</span><span class="p">,</span> <span class="n">ref_peak</span><span class="o">=</span><span class="mi">520</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shifts the x-axis according to a shift calculated prior.</span>

<span class="sd">    :type ref_data: list[float]</span>
<span class="sd">    :param ref_data: Reference measurement.</span>

<span class="sd">    :type ref_axis: list[float]</span>
<span class="sd">    :param ref_axis: X-axis of the reference measurement.</span>

<span class="sd">    :type ref_peak: float</span>
<span class="sd">    :param ref_peak: Where the reference peak should be in x-axis values. The default is 520 (Raman Si).</span>

<span class="sd">    :type mode: int</span>
<span class="sd">    :param mode: Fitting method, Lorentz, Gaussian, or none (1,2,3). The default is 1.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True plots a visual aid. The default is True.</span>

<span class="sd">    :returns: Shift amount</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)</span>
    <span class="n">ref_axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">)</span>
    <span class="c1"># ref_peak = valtoind(ref_peak, ref_axis)</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># fit curves(s), if selected</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># axis shift array</span>
    
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)):</span>  <span class="c1"># depending on the mode chosen...</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lorentzfit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ref_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gaussfit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ref_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lorentzfit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">ref_axis</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gaussfit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">ref_axis</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fit</span><span class="p">)):</span>  <span class="c1"># look for the shift with max value (peak)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>  <span class="c1"># loop in all axis</span>
            <span class="k">if</span> <span class="n">fit</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>  <span class="c1"># if it is the max value,</span>
                <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">ref_peak</span><span class="p">)</span>  <span class="c1"># calculate the diference</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">ref_peak</span><span class="p">)</span>  <span class="c1"># calculate the diference</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># temporal variable</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shift</span><span class="p">)):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">shift</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># make the average</span>

    <span class="n">peakshift</span> <span class="o">=</span> <span class="o">-</span><span class="n">temp</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>  <span class="c1"># figsize = (16,9)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ref_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ref_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ref_peak</span> <span class="o">-</span> <span class="n">peakshift</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ref_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Meas. Max.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">,</span> <span class="n">ref_data</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ref_data</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ref_peak</span> <span class="o">-</span> <span class="n">peakshift</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ref_data</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Meas. Max.&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">ref_peak</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span> <span class="n">ref_peak</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;a.u.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Shift (cm-1)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">peakshift</span></div>


<div class="viewcode-block" id="classify"><a class="viewcode-back" href="../functions.html#functions.classify">[docs]</a><span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gnumber</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">glimits</span><span class="o">=</span><span class="p">[],</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classifies targets according to either defined limits or number of groups.</span>
<span class="sd">    The latter depends on the defined parameters.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Vector with target values to be classified.</span>

<span class="sd">    :type gnumber: int</span>
<span class="sd">    :param gnumber: Number of groups to create. The default is 3 and is the default technique.</span>

<span class="sd">    :type glimits: list[float]</span>
<span class="sd">    :param glimits: Defined group limits. The default is [].</span>
<span class="sd">    </span>
<span class="sd">    :type var: string</span>
<span class="sd">    :param glimits: Name of the variable that is being classified.</span>

<span class="sd">    :returns: Vector with the classification from 0 to N. A list with strings with the name of the groups, useful for plotting.</span>
<span class="sd">    :rtype: list[list,list]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gnumber</span><span class="p">)</span>
    <span class="n">group_limits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">glimits</span><span class="p">)</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># df_targets[&#39;T&#39;] is data from the file, [&#39;NT&#39;] the classification (0 to ...)</span>
    <span class="n">df_targets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
    <span class="n">group_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">class_targets</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [&#39;NT&#39;]</span>

    <span class="c1"># if I set the number of groups</span>
    <span class="k">if</span> <span class="n">group_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">group_limits</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">group_number</span><span class="p">)]</span>
        <span class="n">df_targets</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">group_size</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">/</span> <span class="n">group_number</span><span class="p">)</span>
        <span class="n">left_over</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">-</span> <span class="n">group_size</span> <span class="o">*</span> <span class="n">group_number</span>
        <span class="n">g_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">group_number</span><span class="p">):</span>
            <span class="n">g_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_size</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">group_number</span><span class="p">)</span> <span class="o">*</span> <span class="n">left_over</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g_s</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_s</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">class_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;NT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_targets</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">group_number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">group_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="n">g_s</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">g_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>   
        
        <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &lt;= &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &lt;= &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        
        <span class="n">df_targets</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">class_targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;NT&#39;</span><span class="p">])</span>
        
        <span class="c1"># if I set the limits</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">group_number</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">class_targets</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)):</span>

                <span class="k">if</span> <span class="n">targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">group_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">class_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="n">targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">group_limits</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="n">class_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span>
                <span class="c1"># targets[j] &gt;= group_limits[i] and targets[j] &lt; group_limits[i+1]:</span>
                <span class="k">elif</span> <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="n">class_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; $&lt;$ &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; $&lt;=$ &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; $&lt;$ &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">group_limits</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; $&lt;=$ &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">class_targets</span><span class="p">,</span> <span class="n">group_names</span></div>


<div class="viewcode-block" id="subtractref"><a class="viewcode-back" href="../functions.html#functions.subtractref">[docs]</a><span class="k">def</span> <span class="nf">subtractref</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subtracts a reference spectra from the measurements.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: List of or single vector.</span>

<span class="sd">    :type ref: list[float]</span>
<span class="sd">    :param ref: reference data to remove.</span>

<span class="sd">    :type axis: list[float]</span>
<span class="sd">    :param axis: Axis for both ´data´ and &#39;ref&#39;, only for plotting purposes.</span>

<span class="sd">    :type alpha: float</span>
<span class="sd">    :param alpha: Manual multiplier. The default is 0.9.</span>

<span class="sd">    :type sample: int</span>
<span class="sd">    :param sample: Sample spectra to work with. The default is 0.</span>

<span class="sd">    :type lims: list[int]</span>
<span class="sd">    :param lims: Limits of the plot.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: To plot or not a visual aid. The default is True.</span>

<span class="sd">    :returns: Data with the subtracted reference.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>   
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">data_sub</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data_sub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ref</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">data_sub</span><span class="p">[</span><span class="n">sample</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span><span class="o">*</span><span class="n">alpha</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Air*Alpha&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">sample</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Final&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;a.u.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Shift (cm-1)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data_sub</span> <span class="o">=</span> <span class="n">data_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">data_sub</span></div>


<div class="viewcode-block" id="pearson"><a class="viewcode-back" href="../functions.html#functions.pearson">[docs]</a><span class="k">def</span> <span class="nf">pearson</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">cm</span><span class="o">=</span><span class="s2">&quot;seismic&quot;</span><span class="p">,</span> <span class="n">fons</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figs</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span> <span class="n">tfs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
            <span class="n">ti</span><span class="o">=</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Pearson matrix and plots it.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to correlate.</span>

<span class="sd">    :type labels: list[str]</span>
<span class="sd">    :param labels: Labels of the data.</span>

<span class="sd">    :type cm: str</span>
<span class="sd">    :param cm: Color map as for matplolib. The default is &quot;seismic&quot;.</span>

<span class="sd">    :type fons: int</span>
<span class="sd">    :param fons: Plot font size. The default is 20.</span>

<span class="sd">    :type figs: tuple</span>
<span class="sd">    :param figs: Plot size. The default is (20,17).</span>

<span class="sd">    :type tfs: int</span>
<span class="sd">    :param tfs: Title font size. The default is 25.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True plots the matrix. The default is True.</span>

<span class="sd">    :type ti: str</span>
<span class="sd">    :param ti: Plot title/name. The default is &quot;spearman&quot;.</span>
<span class="sd">    </span>
<span class="sd">    :returns: Pearson plot in a 2d list.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">fonsize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fons</span><span class="p">)</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>
    <span class="n">titlefs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tfs</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

    <span class="n">pears</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cordsi</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># coordinates, same order as labels</span>
    <span class="n">cordsj</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># coordinates, same order as labels</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># for all sets</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># compare with all sets</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">pears</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">cordsi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">cordsj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>

    <span class="n">merged_pears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">pears</span><span class="p">,</span> <span class="n">cordsi</span><span class="p">,</span> <span class="n">cordsj</span><span class="p">]</span>  <span class="c1"># merge to sort together</span>
    <span class="n">merged_pears</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">merged_pears</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># delete the first n (the obvious 1s)</span>
        <span class="n">merged_pears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">merged_pears</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>  <span class="c1"># delete the repeated half</span>
        <span class="n">merged_pears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">merged_pears</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">pears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pears</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>  <span class="c1"># [pearson coeff, p-value]</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fonsize</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">formatt</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedFormatter</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>    
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">pears</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">titlefs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatt</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatt</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pears</span></div>

<div class="viewcode-block" id="spearman"><a class="viewcode-back" href="../functions.html#functions.spearman">[docs]</a><span class="k">def</span> <span class="nf">spearman</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">cm</span><span class="o">=</span><span class="s2">&quot;seismic&quot;</span><span class="p">,</span> <span class="n">fons</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figs</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span> 
             <span class="n">tfs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ti</span><span class="o">=</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Pearson matrix and plots it.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to correlate.</span>

<span class="sd">    :type labels: list[str]</span>
<span class="sd">    :param labels: Labels of the data.</span>

<span class="sd">    :type cm: str</span>
<span class="sd">    :param cm: Color map as for matplolib. The default is &quot;seismic&quot;.</span>

<span class="sd">    :type fons: int</span>
<span class="sd">    :param fons: Plot font size. The default is 20.</span>

<span class="sd">    :type figs: tuple</span>
<span class="sd">    :param figs: Plot size. The default is (20,17).</span>

<span class="sd">    :type tfs: int</span>
<span class="sd">    :param tfs: Title font size. The default is 25.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True plots the matrix. The default is True.</span>

<span class="sd">    :type ti: str</span>
<span class="sd">    :param ti: Plot title/name. The default is &quot;spearman&quot;.</span>
<span class="sd">    </span>
<span class="sd">    :returns: Spearman plot in a 2d list.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">fonsize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fons</span><span class="p">)</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>
    <span class="n">titlefs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tfs</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

    <span class="n">spear</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># spearman</span>
    <span class="n">cordsi</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># coordinates, same order as labels</span>
    <span class="n">cordsj</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># coordinates, same order as labels</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># compare with all sets</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">spear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">cordsi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">cordsj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>

    <span class="n">merged_spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">spear</span><span class="p">,</span> <span class="n">cordsi</span><span class="p">,</span> <span class="n">cordsj</span><span class="p">]</span>  <span class="c1"># merge to sort together</span>
    <span class="n">merged_spear</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">merged_spear</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># delete the first n (the obvious 1s)</span>
        <span class="n">merged_spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">merged_spear</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>  <span class="c1"># delete the repeated half</span>
        <span class="n">merged_spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">merged_spear</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">spear</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>  <span class="c1"># [rho spearman, p-value]</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fonsize</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">formatt</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedFormatter</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">spear</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">titlefs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatt</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatt</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">spear</span></div>


<div class="viewcode-block" id="grau"><a class="viewcode-back" href="../functions.html#functions.grau">[docs]</a><span class="k">def</span> <span class="nf">grau</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">cm</span><span class="o">=</span><span class="s2">&quot;seismic&quot;</span><span class="p">,</span> <span class="n">fons</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figs</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
         <span class="n">tfs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ti</span><span class="o">=</span><span class="s2">&quot;Grau (Beta)&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">marks</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs Grau correlation matrix and plots it.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to be correlated.</span>

<span class="sd">    :type labels: list[str]</span>
<span class="sd">    :param labels: Labels of the data to be ploted.</span>

<span class="sd">    :type cm: str</span>
<span class="sd">    :param cm: Color map for the plot, from matplotlib. The default is &quot;seismic&quot;.</span>

<span class="sd">    :type fons: int, optional</span>
<span class="sd">    :param fons: Plot font size. The default is 20.</span>

<span class="sd">    :type figs: tuple</span>
<span class="sd">    :param figs: Figure size. The default is (25,15).</span>

<span class="sd">    :type tfs: int</span>
<span class="sd">    :param tfs: Plot title font size. The default is 25.</span>

<span class="sd">    :type ti: str</span>
<span class="sd">    :param ti: Plot title. The default is &quot;Grau (Beta)&quot;.</span>

<span class="sd">    :type marker: str</span>
<span class="sd">    :param marker: Plot marker type (scatter). The default is &quot;s&quot;.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True plots the matrix. The default is True.</span>

<span class="sd">    :type marks: int</span>
<span class="sd">    :param marks: Marker size. The default is 100.</span>
<span class="sd">    </span>
<span class="sd">    :returns: Grau plot in a 2d list.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fons</span><span class="p">)</span>  <span class="c1"># plot font size</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>  <span class="c1"># plot size</span>
    <span class="n">titlefs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tfs</span><span class="p">)</span>  <span class="c1"># title font size</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>  <span class="c1"># plot name</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>  <span class="c1"># market style</span>
    <span class="n">marks</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">marks</span><span class="p">)</span>  <span class="c1"># marker size</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

    <span class="n">graus</span> <span class="o">=</span> <span class="n">evalgrau</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># grau correlation (3d R2)</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="p">[</span><span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">))]</span>  <span class="c1"># first dimension values</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="p">[</span><span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">))]</span>  <span class="c1"># second dimension values</span>
    <span class="n">g3</span> <span class="o">=</span> <span class="p">[</span><span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">))]</span>  <span class="c1"># third dimension values</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="p">[</span><span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">))]</span>  <span class="c1"># mse&#39;s list</span>
    <span class="n">g2_shift</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span>  <span class="c1"># copy v2 to displace the d2 values for plotting</span>
    <span class="n">t_c</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of ticks per subplot</span>
    <span class="n">xtick_labels</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list for labels</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># number of different # in combs[i][0] (first column), starts with 1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># for all combinations</span>
        <span class="k">if</span> <span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">graus</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># if it is different</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># then it is a new one</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>  <span class="c1"># for all the different first positions</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># temporal variable to count ticks</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># check all the combinations</span>
            <span class="k">if</span> <span class="n">graus</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># if it is the one we are looking for</span>
                <span class="k">if</span> <span class="n">graus</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">graus</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># if it changes, then new tick</span>
                    <span class="n">temp</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># add</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if it doesnt count, is because there is only 1</span>
            <span class="n">t_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># so append 1</span>
        <span class="k">elif</span> <span class="n">temp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># if only 1 is counted</span>
            <span class="n">t_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># then add a 2</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># otherwise,</span>
            <span class="n">t_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>  <span class="c1"># when it is done, append to the list</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_c</span><span class="p">)):</span>  <span class="c1"># for all the different #</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t_c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># for the number of different 2d</span>
            <span class="n">xtick_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>  <span class="c1"># append the value +1</span>
    <span class="n">xtick_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># append &#39;&#39; for the last label to be blank</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g1</span><span class="p">)):</span>  <span class="c1"># to shift the position for plotting</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_c</span><span class="p">)):</span>  <span class="c1"># for all the ticks in x axis</span>
            <span class="k">if</span> <span class="n">g1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">j</span><span class="p">:</span>  <span class="c1"># if bigger than 0 (first)</span>
                <span class="n">g2_shift</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">t_c</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># shift (add) all the previous</span>


    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>   
    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">y_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">g3</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">g3</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">x_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">g2_shift</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">ytick_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)):</span>
        <span class="n">ytick_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">y_ticks</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xtick_labels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">xtick_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">xtick_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">titlefs</span><span class="p">)</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">g2_shift</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">mse</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">marks</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xtick_labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ytick_labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_c</span><span class="p">)):</span>
            <span class="n">temp</span> <span class="o">+=</span> <span class="n">t_c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xgridlines</span><span class="p">()[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xgridlines</span><span class="p">()[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xgridlines</span><span class="p">()[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">g2_shift</span></div>


<div class="viewcode-block" id="moveavg"><a class="viewcode-back" href="../functions.html#functions.moveavg">[docs]</a><span class="k">def</span> <span class="nf">moveavg</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">move</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the moving average of a single or multiple vectors.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to calculate the moving average. Single or multiple vectors.</span>

<span class="sd">    :type move: int</span>
<span class="sd">    :param move: Average range to each side (total average = move + 1).</span>

<span class="sd">    :returns: Smoothed vector(s).</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">move</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">move</span><span class="p">,</span> <span class="n">data_len</span> <span class="o">-</span> <span class="n">move</span><span class="p">):</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="n">move</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">move</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">move</span><span class="p">):</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">avg</span></div>


<div class="viewcode-block" id="plot2dml"><a class="viewcode-back" href="../functions.html#functions.plot2dml">[docs]</a><span class="k">def</span> <span class="nf">plot2dml</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="p">[],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">,</span> <span class="s1">&#39;D2&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">train_pred</span><span class="o">=</span><span class="p">[],</span> 
             <span class="n">test_pred</span><span class="o">=</span><span class="p">[],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xax</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">yax</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> 
             <span class="n">lfs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots 2-dimensional results from LDA, PCA, NCA, or similar machine learning</span>
<span class="sd">    algoruthms where the output has 2 features per sample.</span>
<span class="sd">    </span>
<span class="sd">    :type train: pandas frame</span>
<span class="sd">    :param train: Results for the training set. Pandas frame with the 2 dimensions</span>
<span class="sd">        and target columns.</span>

<span class="sd">    :type test: pandas frame</span>
<span class="sd">    :param test: Results for the test set. Pandas frame with the 2 dimensions</span>
<span class="sd">        and target columns.</span>
<span class="sd">    </span>
<span class="sd">    :type names: list[str]</span>
<span class="sd">    :param names: Name of the lables in the dataframe. For example, for LDA:</span>
<span class="sd">        D1, D2 and T.    </span>
<span class="sd">    </span>
<span class="sd">    :type train_pred: list</span>
<span class="sd">    :param train_pred: Prediction of the training set.</span>

<span class="sd">    :type test_pred: list</span>
<span class="sd">    :param test_pred: Prediction of the test set.</span>

<span class="sd">    :type labels: list</span>
<span class="sd">    :param labels: Names for the classification groups, if any.</span>
<span class="sd">        </span>
<span class="sd">    :type title: str</span>
<span class="sd">    :param title: Title of the plot.</span>
<span class="sd">        </span>
<span class="sd">    :type xax: str</span>
<span class="sd">    :param xax: Name ox x-axis</span>
<span class="sd">        </span>
<span class="sd">    :type yax: str</span>
<span class="sd">    :param yax: Name of y-axis</span>
<span class="sd">        </span>
<span class="sd">    :type lfs: int</span>
<span class="sd">    :param lfs: Legend font size. Default is 15.</span>
<span class="sd">        </span>
<span class="sd">    :type loc: str</span>
<span class="sd">    :param loc: Location of legend. Default is best.</span>
<span class="sd">    </span>
<span class="sd">    :type size: int</span>
<span class="sd">    :param size: Size of the markers. Default is 20.</span>
<span class="sd">    </span>
<span class="sd">    :type xlim: list</span>
<span class="sd">    :param xlim: Limits of the x axis.</span>
<span class="sd">    </span>
<span class="sd">    :type ylim: list</span>
<span class="sd">    :param ylim: Limits of the y axis.</span>
<span class="sd">    </span>
<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True it plot. Only for test purposes.</span>
<span class="sd">        </span>
<span class="sd">    :returns: Plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># marker = [&#39;o&#39;, &#39;v&#39;, &#39;s&#39;, &#39;d&#39;, &#39;*&#39;, &#39;^&#39;, &#39;x&#39;, &#39;+&#39;, &#39;.&#39;,</span>
    <span class="c1">#           &#39;o&#39;, &#39;v&#39;, &#39;s&#39;, &#39;d&#39;, &#39;*&#39;, &#39;^&#39;, &#39;x&#39;, &#39;+&#39;, &#39;.&#39;]</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
              <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">]</span>
    <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;olive&#39;</span><span class="p">,</span> <span class="s1">&#39;lime&#39;</span><span class="p">,</span>
             <span class="s1">&#39;springgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;mediumspringgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;turquoise&#39;</span><span class="p">,</span> <span class="s1">&#39;indigo&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;deeppink&#39;</span><span class="p">,</span> <span class="s1">&#39;crimson&#39;</span><span class="p">]</span>
    
    <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">legend_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> 
                                   <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span> 
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)):</span>  
        <span class="n">group</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ec</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_pred</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">train_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">train</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">ec</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                        <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">group</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">[</span><span class="n">group</span><span class="p">],</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">ec</span><span class="p">)</span>
            
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>        
        <span class="n">group</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ec</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
        
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_pred</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">test_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">test</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">ec</span> <span class="o">=</span> <span class="s1">&#39;fuchsia&#39;</span>
                
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                        <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">group</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">[</span><span class="n">group</span><span class="p">],</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">ec</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">yax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>    
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">lfs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">plot</span></div>

    
<div class="viewcode-block" id="stackplot"><a class="viewcode-back" href="../functions.html#functions.stackplot">[docs]</a><span class="k">def</span> <span class="nf">stackplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral&#39;</span><span class="p">,</span> 
              <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">fs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xlimits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots a stack plot of selected spectras.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to plot. Must be more than 1 vector.</span>

<span class="sd">    :type offset: float</span>
<span class="sd">    :param offset: displacement, or difference, between each curve.</span>

<span class="sd">    :type order: list[int]</span>
<span class="sd">    :param order: Order of the curves in which they are plotted. If `None`,</span>
<span class="sd">        is the order as they appear in the list.</span>

<span class="sd">    :type xlabel: str</span>
<span class="sd">    :param xlabel: Label of axis.</span>

<span class="sd">    :type ylabel: str</span>
<span class="sd">    :param ylabel: Label of axis.</span>

<span class="sd">    :type title: str</span>
<span class="sd">    :param title: Title of the plot.</span>

<span class="sd">    :type cmap: str</span>
<span class="sd">    :param cmap: Colormap, according to matplotlib options.</span>

<span class="sd">    :type figsize: tuple</span>
<span class="sd">    :param figsize: Size of the plot. Default is (3, 4.5)</span>

<span class="sd">    :type fs: float</span>
<span class="sd">    :param fs: Font size. Default is 20.</span>

<span class="sd">    :type lw: float</span>
<span class="sd">    :param lw: Linewidth of the curves.</span>
<span class="sd">    </span>
<span class="sd">    :type xlim: list[float]</span>
<span class="sd">    :param xlim: Plot limits for x-axis. If `None` it plots all.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True it plot. Only for test purposes.</span>

<span class="sd">    :returns: plot</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>      
       
    <span class="n">base</span> <span class="o">=</span> <span class="p">[</span><span class="n">offset</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
    
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xlimits</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  
        
    <span class="k">return</span> <span class="n">plot</span></div>


<div class="viewcode-block" id="cosmicmp"><a class="viewcode-back" href="../functions.html#functions.cosmicmp">[docs]</a><span class="k">def</span> <span class="nf">cosmicmp</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">avg</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It identifies CRs by comparing similar spectras and paring in matching</span>
<span class="sd">    pairs. Uses randomnes of CRs (S. J. Barton, B. M. Hennelly, https://doi.org/10.1177/0003702819839098)</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of spectras to remove cosmic rays.</span>

<span class="sd">    :type alpha: float</span>
<span class="sd">    :param alpha: Factor to modify the criteria to identify a cosmic ray.</span>

<span class="sd">    :type avg: int</span>
<span class="sd">    :param avg: Moving average window.</span>

<span class="sd">    :returns: Data with removed cosmic rays.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="n">sim_specs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># most similar spectra (position) for each spectra i</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># for all the spectras</span>
        <span class="n">n_cov</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># position of most similar spectra, initial value</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># to compare similarity of the spectras</span>
        <span class="n">paired</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># if it is already paired with another spectra</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_specs</span><span class="p">)):</span>  <span class="c1"># check if it is already paired</span>
            <span class="k">if</span> <span class="n">sim_specs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># if it is</span>
                <span class="n">n_cov</span> <span class="o">=</span> <span class="n">j</span>  <span class="c1"># claculate nothing and just save it</span>
                <span class="n">paired</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># set as paired</span>
        
        <span class="k">if</span> <span class="n">paired</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if not paired, then calculate</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># first term of equation</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># search in all spectras</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># second term of eq.</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>  <span class="c1"># third term of eq.</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># final value to campare</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="n">cov</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># the highest value (covariance) wins</span>
                    <span class="n">n_cov</span> <span class="o">=</span> <span class="n">j</span>  <span class="c1"># save the best</span>
                    <span class="n">cov</span> <span class="o">=</span> <span class="n">temp</span>  <span class="c1"># save the best to compare</span>
        
        <span class="n">sim_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_cov</span><span class="p">)</span>  <span class="c1"># save the similar curve</span>
        
        <span class="n">mavg</span> <span class="o">=</span> <span class="n">moveavg</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">avg</span><span class="p">)</span>
        
        <span class="n">sigma</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">sigma</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">mavg</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>  <span class="c1"># search in all the spectra</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">sim_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sigma</span><span class="o">*</span><span class="n">alpha</span><span class="p">:</span>  <span class="c1"># if res. is higher than the stdev</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">sim_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># must be CR, change the value</span>
                        
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="cosmicdd"><a class="viewcode-back" href="../functions.html#functions.cosmicdd">[docs]</a><span class="k">def</span> <span class="nf">cosmicdd</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">th</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">asy</span><span class="o">=</span><span class="mf">0.6745</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It identifies CRs by detrended differences, the differences between a</span>
<span class="sd">    value and the next (D. A. Whitaker and K. Hayes, https://doi.org/10.1016/j.chemolab.2018.06.009).</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of spectras to remove cosmic rays.</span>

<span class="sd">    :type th: float</span>
<span class="sd">    :param th: Factor to modify the criteria to identify a cosmic ray.</span>
<span class="sd">    </span>
<span class="sd">    :type asy: float</span>
<span class="sd">    :param asy: Asymptotic bias correction</span>
<span class="sd">    </span>
<span class="sd">    :type m: float</span>
<span class="sd">    :param m: Number of neighbor values to use for average.</span>

<span class="sd">    :returns: Data with removed cosmic rays.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>  <span class="c1"># diff data</span>
     
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># for each spectra</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># for each step</span>
            <span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># diff with the next one</span>
    
    <span class="n">zt</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Z scores</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>  <span class="c1"># for each diff. vector</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># temporal z score</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># temporal MAD (median absolute deviation)</span>
        <span class="n">med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># just median</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># for each step in each diff. spectra</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">med</span><span class="p">))</span>  <span class="c1"># calculate MAD</span>
        <span class="n">mad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>  <span class="c1"># save MAD</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># for each step in each diff. spectra</span>
            <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asy</span><span class="o">*</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">med</span><span class="p">)</span><span class="o">/</span><span class="n">mad</span><span class="p">)</span>  <span class="c1"># calculate Z score</span>
        <span class="n">zt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># save Z score</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># for each spectra</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># in all its len. except the last (range)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">th</span><span class="p">:</span>  <span class="c1"># if it is larger than the th. then it is CR</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">:</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">)</span>  <span class="c1"># avg, of neighbors</span>
    
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="cosmicmed"><a class="viewcode-back" href="../functions.html#functions.cosmicmed">[docs]</a><span class="k">def</span> <span class="nf">cosmicmed</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Precise cosmic ray elimination for measurements of the same point or very</span>
<span class="sd">    similar spectras.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: List of spectras to remove cosmic rays.</span>

<span class="sd">    :type sigma: float</span>
<span class="sd">    :param sigma: Factor to modify the criteria to identify a cosmic ray.</span>
<span class="sd">        Multiplies the median of each bin.</span>

<span class="sd">    :returns: Data with removed cosmic rays.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>     
    <span class="n">acq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solved</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solved</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="n">med</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">solved</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">acq</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sigma</span><span class="o">*</span><span class="n">med</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">solved</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">med</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">solved</span></div>


<div class="viewcode-block" id="makeaxisstep"><a class="viewcode-back" href="../functions.html#functions.makeaxisstep">[docs]</a><span class="k">def</span> <span class="nf">makeaxisstep</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an axis, or vector, from &#39;start&#39; with bins of length &#39;step&#39; </span>
<span class="sd">    for a distance of &#39;length&#39;.</span>
<span class="sd">    </span>
<span class="sd">    :type start: float </span>
<span class="sd">    :param start: first value of the axis. Default is 0.</span>
<span class="sd">        </span>
<span class="sd">    :type step: float</span>
<span class="sd">    :param step: Step size for the axis. Default is 1.00.</span>
<span class="sd">        </span>
<span class="sd">    :type length: int</span>
<span class="sd">    :param length: LEngth of axis. Default is 1000.</span>
<span class="sd">    </span>
<span class="sd">    :type adjust: boolean</span>
<span class="sd">    :param adjust: If True, rounds (adjusts) the deimals points to the same</span>
<span class="sd">        as the step has. Default is False.</span>
<span class="sd">        </span>
<span class="sd">    :type rounded: int </span>
<span class="sd">    :param rounded: Number of decimals to consider. If -1 then no rounding is</span>
<span class="sd">        performed.</span>
<span class="sd">        </span>
<span class="sd">    :returns: Axis with the set parameters.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">adjust</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rounded</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span><span class="p">,</span><span class="n">rounded</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="makeaxisdivs"><a class="viewcode-back" href="../functions.html#functions.makeaxisdivs">[docs]</a><span class="k">def</span> <span class="nf">makeaxisdivs</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">divs</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an axis, or vector, from &#39;start&#39; to &#39;finish&#39; with &#39;divs&#39; divisions. </span>
<span class="sd">    </span>
<span class="sd">    :type start: float </span>
<span class="sd">    :param start: First value of the axis.</span>
<span class="sd">        </span>
<span class="sd">    :type finish: float</span>
<span class="sd">    :param finish: Last value of the axis.</span>
<span class="sd">        </span>
<span class="sd">    :type divs: int</span>
<span class="sd">    :param divs: Number of divisions</span>
<span class="sd">        </span>
<span class="sd">    :type rounded: int </span>
<span class="sd">    :param rounded: Number of decimals to consider. If -1 then no rounding is</span>
<span class="sd">        performed.</span>
<span class="sd">        </span>
<span class="sd">    :returns: Axis with the set parameters.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">finish</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">divs</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rounded</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span><span class="p">,</span><span class="n">rounded</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">divs</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">divs</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="minmax"><a class="viewcode-back" href="../functions.html#functions.minmax">[docs]</a><span class="k">def</span> <span class="nf">minmax</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the vectors that contain the minimum and maximum values of each</span>
<span class="sd">    bin from a list of vectors.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list </span>
<span class="sd">    :param y: List of vectors to calculate the minimum and maximum vectors.</span>
<span class="sd">                </span>
<span class="sd">    :returns: minimum and maximum vectors.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">y</span><span class="p">)]</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">y</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span></div>


<div class="viewcode-block" id="fwhm"><a class="viewcode-back" href="../functions.html#functions.fwhm">[docs]</a><span class="k">def</span> <span class="nf">fwhm</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Full Width Half Maximum of specific peak or list of</span>
<span class="sd">    peaks for a single or multiple spectras.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list</span>
<span class="sd">    :param y: spectrocopic data to calculate the fwhm from. Single vector or</span>
<span class="sd">        list of vectors.    </span>

<span class="sd">    :type x: list</span>
<span class="sd">    :param x: Axis of the data. If none, then the axis will be 0..N where N</span>
<span class="sd">        is the length of the spectra or spectras.</span>
<span class="sd">    </span>
<span class="sd">    :type peaks: float or list[float]</span>
<span class="sd">    :param peaks: Aproximate axis value of the position of the peak. If single</span>
<span class="sd">        peak then a float is needed. If many peaks are requierd then a list of</span>
<span class="sd">        them.</span>
<span class="sd">    </span>
<span class="sd">    :type alpha: float</span>
<span class="sd">    :param alpha: multiplier of maximum value to find width ratio. Default is 0.5</span>
<span class="sd">        which makes this a `full width half maximum`. If `alpha=0.25`, it would</span>
<span class="sd">        basically find the `full width quarter maximum`. `alpha` should be </span>
<span class="sd">        ´0 &lt; alpha &lt; 1´. Default is 0.5.</span>
<span class="sd">    </span>
<span class="sd">    :type s: int</span>
<span class="sd">    :param s: Shift to sides to check real peak. The default is 10.   </span>
<span class="sd">        </span>
<span class="sd">    :type interpolate: boolean</span>
<span class="sd">    :param interpolate: If True, will interpolte according to `step` and `s`.   </span>
<span class="sd">    </span>
<span class="sd">    :returns: A list, or single float value, of the fwhm.</span>
<span class="sd">    :rtype: float or list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
        
    <span class="n">ind</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">dims_peaks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims_peaks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    
    <span class="n">r_fwhm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
        
        <span class="n">fwhm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]]:</span>
                    <span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                       
            <span class="n">h_m</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">*</span><span class="n">alpha</span> <span class="c1"># half maximum </span>

            <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
            <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">h_m</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="n">delta</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">delta</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">i</span>
            
            <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">h_m</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="n">delta</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">delta</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">i</span>
            
            <span class="k">if</span> <span class="n">dims_peaks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fwhm</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">right</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">right</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">r_fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fwhm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

    <span class="k">return</span> <span class="n">r_fwhm</span>   </div>


<div class="viewcode-block" id="asymmetry"><a class="viewcode-back" href="../functions.html#functions.asymmetry">[docs]</a><span class="k">def</span> <span class="nf">asymmetry</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compares both sides of a peak, or list of peaks, and checks how similar </span>
<span class="sd">    they are. It does this by calculating the MRSE and indicating which side is </span>
<span class="sd">    larger or smaller by area. If it is a negative (-), then left side is</span>
<span class="sd">    smaller.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list</span>
<span class="sd">    :param y: spectrocopic data to calculate the asymmetry from. Single vector or</span>
<span class="sd">        list of vectors.    </span>
<span class="sd">         </span>
<span class="sd">    :type x: list</span>
<span class="sd">    :param x: Axis of the data. If none, then the axis will be 0..N where N is</span>
<span class="sd">        the length of the spectra or spectras.</span>

<span class="sd">    :type peak: float, list[float]</span>
<span class="sd">    :param peak: Aproximate axis value of the position of the peak. If sinlge</span>
<span class="sd">        peak then a float is needed. If many peaks are requierd then a list of</span>
<span class="sd">        them.</span>

<span class="sd">    :type s: int</span>
<span class="sd">    :param s: Shift to sides to check real peak. The default is 5.   </span>
<span class="sd">        </span>
<span class="sd">    :type limit: int</span>
<span class="sd">    :param limit: Comparison limits to each side of the peak. Default is 10. </span>
<span class="sd">    </span>
<span class="sd">    :returns: R2 value comparing both sides of the peak and a sign to tell if</span>
<span class="sd">        either left side is smaller (negative) or tight side is smaller</span>
<span class="sd">        (positive, no sign included).</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
    
    <span class="n">final</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">diff_nom</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">diff_abs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
            <span class="n">diff_nom</span> <span class="o">+=</span> <span class="n">h</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">diff_abs</span> <span class="o">+=</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">diff_nom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># left side is smaller -&gt; right larger</span>
            <span class="n">diff_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">diff_abs</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">limit</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff_abs</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">final</span> <span class="o">=</span> <span class="n">final</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">final</span></div>


<div class="viewcode-block" id="rwm"><a class="viewcode-back" href="../functions.html#functions.rwm">[docs]</a><span class="k">def</span> <span class="nf">rwm</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the median of an array in a running window defined by the user.</span>
<span class="sd">    The window size needs to be a 2D tuple or list, with the first element being the</span>
<span class="sd">    length of the spectra and the second the total width that will be taken into account</span>
<span class="sd">    for the statistics.</span>

<span class="sd">    :type y: numpy array</span>
<span class="sd">    :param y: The spectras </span>

<span class="sd">    :type ws: tuple/list</span>
<span class="sd">    :param ws: Window size parameters</span>

<span class="sd">    :type plot: boolean</span>
<span class="sd">    :param plot: If you want to plot the new spectra change to True</span>

<span class="sd">    :returns: Array containing the computed 1D spectra.</span>
<span class="sd">    :rtype: numpy array[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check dimensions</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ws</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The window must be 2D&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ws</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The width must be an odd number&quot;</span><span class="p">)</span>
        
    <span class="c1"># First pad the end and the beginning by duplicating the first and last columns from the spectras</span>
    <span class="n">pad_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ws</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">data_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">[:,</span><span class="o">-</span><span class="n">pad_length</span><span class="p">:]]</span>
    <span class="n">data_new2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">y</span><span class="p">[:,:</span><span class="n">pad_length</span><span class="p">],</span> <span class="n">data_new</span><span class="p">]</span>
    
    <span class="c1"># Get the windows</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">stride_tricks</span><span class="o">.</span><span class="n">sliding_window_view</span><span class="p">(</span><span class="n">data_new2</span><span class="p">,</span> <span class="n">ws</span><span class="p">)</span>
    
    <span class="c1"># Create new spectra from the median of each window</span>
    <span class="n">new_spectra</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">new_spectra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">new_spectra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_spectra</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">new_spectra</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">new_spectra</span></div>


<div class="viewcode-block" id="typical"><a class="viewcode-back" href="../functions.html#functions.typical">[docs]</a><span class="k">def</span> <span class="nf">typical</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Looks for the typical spectra of a dataset. In other words, it calculates </span>
<span class="sd">    the average spectra and looks for the one that is closer to it in relation</span>
<span class="sd">    to standard deviation. Do not confuse with a `Representative` spectra.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[list[float]]</span>
<span class="sd">    :param y: A list of spectras.   </span>
<span class="sd">        </span>
<span class="sd">    :returns: The typical spectra of the set.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">avg</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="n">std</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
    <span class="n">typical</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sdev</span><span class="p">([</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="n">std</span><span class="p">:</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">typical</span> <span class="o">=</span> <span class="n">i</span>
    
    <span class="k">return</span> <span class="n">typical</span></div>


<div class="viewcode-block" id="issinglevalue"><a class="viewcode-back" href="../functions.html#functions.issinglevalue">[docs]</a><span class="k">def</span> <span class="nf">issinglevalue</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if a vector, or a list of vectors, is composed of the same value</span>
<span class="sd">    (single value vector). Not to be confused with a single element vector </span>
<span class="sd">    were the length of the vector is 1.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list</span>
<span class="sd">    :param y: Vector, or list of vectors, that needs to be checked.</span>
<span class="sd">    </span>
<span class="sd">    :returns: True if contains the same value. False if there are different. If</span>
<span class="sd">        `y` is a list of vectors then it returns a list of booleans with the </span>
<span class="sd">        respective answer.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">:</span> <span class="c1"># checks if y is a list of lists</span>
        <span class="n">isequal</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">==</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span> <span class="c1"># applies the check to each list in y</span>
    <span class="k">elif</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">isequal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">==</span><span class="mi">1</span> <span class="c1"># checks if all elements in the list are equal</span>
    <span class="k">return</span> <span class="n">isequal</span></div>


<div class="viewcode-block" id="mahalanobis"><a class="viewcode-back" href="../functions.html#functions.mahalanobis">[docs]</a><span class="k">def</span> <span class="nf">mahalanobis</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Mahalanobis distance for a groups of vectors to the center </span>
<span class="sd">    of mass, or average coordinates.</span>
<span class="sd">    </span>
<span class="sd">    :param v: vectors to calculate the distance</span>
<span class="sd">    :type v: list</span>
<span class="sd">    </span>
<span class="sd">    :returns: List of the respectve distances.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">avg</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span>
                <span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">mean</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">cov</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">length</span>            
    
    <span class="n">inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
    <span class="n">mahdist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
        <span class="n">mahdist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">mean</span><span class="p">)),</span> <span class="n">inverse</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">mean</span><span class="p">))))</span>

    <span class="k">return</span> <span class="n">mahdist</span></div>


<div class="viewcode-block" id="representative"><a class="viewcode-back" href="../functions.html#functions.representative">[docs]</a><span class="k">def</span> <span class="nf">representative</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Looks for the representative spectra of a dataset. In other words, it calculates </span>
<span class="sd">    the median spectra and looks for the one that is closer to it in relation</span>
<span class="sd">    to standard deviation. Do not confuse with a `Typical` spectra.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[list[float]]</span>
<span class="sd">    :param y: A list of spectras.   </span>
<span class="sd">        </span>
<span class="sd">    :returns: The representative spectra of the set.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="n">std</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
    <span class="n">reptve</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sdev</span><span class="p">([</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="n">std</span><span class="p">:</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="n">reptve</span> <span class="o">=</span> <span class="n">i</span>
    
    <span class="k">return</span> <span class="n">reptve</span></div>


<div class="viewcode-block" id="voigtfit"><a class="viewcode-back" href="../functions.html#functions.voigtfit">[docs]</a><span class="k">def</span> <span class="nf">voigtfit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">look</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits peak as an optimization problem or manual fit for Voigt distirbution,</span>
<span class="sd">    also known as a convoluted Gaussian-Lorentz curve. A curve `y` is only</span>
<span class="sd">    needed for the optimization (manual=False, default). If no axis `x` is </span>
<span class="sd">    defined, then a default axis is generated for both options. It is reccomended to</span>
<span class="sd">    Normalize the data before fitting.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to fit. Single vector.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis.</span>

<span class="sd">    :type pos: int</span>
<span class="sd">    :param pos: X axis position of the peak.</span>

<span class="sd">    :type look: int</span>
<span class="sd">    :param look: axis positions to look to each side in axis units. The default is 5.</span>

<span class="sd">    :type shift: int</span>
<span class="sd">    :param shift: Possible axis shift of the peak in axis units. The default is 2.</span>

<span class="sd">    :type gamma: float</span>
<span class="sd">    :param gamma: Initial value of fit. The default is 5.</span>
<span class="sd">    </span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :param sigma: Initial value of fit. The default is 4.</span>
<span class="sd">    </span>
<span class="sd">    :type alpha: float</span>
<span class="sd">    :param alpha: Multiplier of the fitting. The maximum value fo the fitting</span>
<span class="sd">        is proportional to this value, but is not necesarly its value. The</span>
<span class="sd">        default is 1.</span>
<span class="sd">    </span>
<span class="sd">    :type manual: boolean</span>
<span class="sd">    :param manual: If `True`, 1 curve will be generated using the declared </span>
<span class="sd">        parameter `gamma` and perform a manual fit. Default is `False`.</span>

<span class="sd">    :returns: Fitted curve.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">x</span>  
        
    <span class="k">if</span> <span class="n">manual</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># if no axis is passed</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">lor</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gamma</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span><span class="o">/</span><span class="n">gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">gau</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(((</span><span class="n">i</span><span class="o">-</span><span class="n">pos</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gau</span><span class="o">*</span><span class="n">lor</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># if no axis is passed</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">look</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">look</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">valtoind</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="n">s</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
    
        <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">ppos</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ax</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ppos</span><span class="o">-</span><span class="n">look</span><span class="p">,</span> <span class="n">ppos</span><span class="o">+</span><span class="n">look</span><span class="p">):</span>  <span class="c1"># for all the points            </span>
                <span class="n">gau</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(((</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>    
                <span class="n">lor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> 
                <span class="n">fit</span> <span class="o">=</span> <span class="n">gau</span><span class="o">*</span><span class="n">lor</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="n">error</span> <span class="o">+=</span> <span class="p">(</span><span class="n">fit</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># total     </span>
            
            <span class="k">return</span> <span class="n">error</span><span class="o">**</span><span class="mf">0.5</span>
    
        <span class="k">def</span> <span class="nf">constraint1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>  <span class="c1"># master vector to optimize, initial values</span>
        <span class="n">bnds</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00000001</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">99999</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">9999</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">9999</span><span class="p">],</span> <span class="p">[(</span><span class="n">p</span><span class="o">-</span><span class="n">s</span><span class="p">),</span> <span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">s</span><span class="p">)]]</span>
        <span class="n">con1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint1</span><span class="p">}</span>
        <span class="n">cons</span> <span class="o">=</span> <span class="p">([</span><span class="n">con1</span><span class="p">])</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">x</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
    
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
            <span class="n">lor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
            <span class="n">gau</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(((</span><span class="n">ax</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gau</span><span class="o">*</span><span class="n">lor</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>       
 
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span></div>


<div class="viewcode-block" id="autocorrelation"><a class="viewcode-back" href="../functions.html#functions.autocorrelation">[docs]</a><span class="k">def</span> <span class="nf">autocorrelation</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lag</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the correlation of a signal with a delayed copy of itself as a </span>
<span class="sd">    function of the lag. In other words, it calculates the PEarsoon coefficient </span>
<span class="sd">    for a vector with itself shifted by `lag` positions.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to fit. Single or list of vectors.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis.</span>

<span class="sd">    :type lag: int</span>
<span class="sd">    :param lag: positions shifetd to be analyzed, not in x-axis values.</span>

<span class="sd">    :type lims: list[float, float]</span>
<span class="sd">    :param lims: limits of the data to autocorrelate. Defauilt is `None` and</span>
<span class="sd">        will analyze with all the vector (`[0:len(y)]`).</span>

<span class="sd">    :type normalization: boolean</span>
<span class="sd">    :param normalization: divides the autocorrelation value by the product of</span>
<span class="sd">        the standard deviation of the series in `t` and `t+lag`.</span>

<span class="sd">    :type average: boolean</span>
<span class="sd">    :param average: divides the autocorrelation value by the length of the </span>
<span class="sd">        signal.</span>

<span class="sd">    :returns: autocorrelation values, either in a list or single value.</span>
<span class="sd">    :rtype: float, list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">lims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="n">lims</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">lims</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    
    <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">lag</span><span class="p">:</span><span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="nb">int</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lag</span><span class="p">)]</span>
        <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">normalization</span><span class="p">:</span>
            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">sdev</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span> <span class="n">sdev</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">average</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">s1</span><span class="o">*</span><span class="n">s2</span><span class="o">*</span><span class="n">a</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
    
    <span class="k">return</span> <span class="n">c</span></div>


<div class="viewcode-block" id="crosscorrelation"><a class="viewcode-back" href="../functions.html#functions.crosscorrelation">[docs]</a><span class="k">def</span> <span class="nf">crosscorrelation</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">lag</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the correlation of a signal with a delayed copy of a second</span>
<span class="sd">    signal in function of the lag. In other words, measures the similarity</span>
<span class="sd">    between two series that are displaced relative to each other.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to fit. Single or list of vectors.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis.</span>

<span class="sd">    :type lag: int</span>
<span class="sd">    :param lag: positions shifetd to be analyzed, not in x-axis values.</span>

<span class="sd">    :type lims: list[float, float]</span>
<span class="sd">    :param lims: limits of the data to autocorrelate. Defauilt is `None` and</span>
<span class="sd">        will analyze with all the vector (`[0:len(y)]`).</span>

<span class="sd">    :type normalization: boolean</span>
<span class="sd">    :param normalization: divides the cross-correlation value by the product of</span>
<span class="sd">        the standard deviation of the series in `t` and `t+lag`.</span>

<span class="sd">    :type average: boolean</span>
<span class="sd">    :param average: divides the cross-correlation value by the length of the </span>
<span class="sd">        signals.</span>

<span class="sd">    :returns: autocorrelation values, either in a list or single value.</span>
<span class="sd">    :rtype: float, list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">lims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)]</span>
    
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">lag</span><span class="p">:</span><span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lag</span><span class="p">]</span>
    
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">normalization</span><span class="p">:</span>
        <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">sdev</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span> <span class="n">sdev</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">average</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">s1</span><span class="o">*</span><span class="n">s2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span></div>


<div class="viewcode-block" id="derivative"><a class="viewcode-back" href="../functions.html#functions.derivative">[docs]</a><span class="k">def</span> <span class="nf">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the derivative function of a vector. It does so by calculating</span>
<span class="sd">    the slope on a point using the position of the neighboring points.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: Data to fit. Single or list of vectors.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis. If `None`, an axis will be created from 1..N, where N is</span>
<span class="sd">        the length of `y`. Default is `None.</span>
<span class="sd">        </span>
<span class="sd">    :type s: int</span>
<span class="sd">    :param s: size of the range to each side of the point to use to calculate </span>
<span class="sd">        the slope. Default is 1.</span>
<span class="sd">        </span>
<span class="sd">    :type deg: int</span>
<span class="sd">    :param deg: degree of the derivative. That is, number of timess the vector</span>
<span class="sd">        will be derivated. In other words, if `deg=2`, will calculate the </span>
<span class="sd">        second derivative. Default is `1`.</span>
<span class="sd">        </span>
<span class="sd">    :returns: derivative values, either in a list or single value.</span>
<span class="sd">    :rtype: float, list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>


    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

    <span class="n">tl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">tl</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">deg</span><span class="p">):</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">[((</span><span class="n">j</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">j</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">s</span> <span class="k">else</span>
                    <span class="p">((</span><span class="n">j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">j</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">s</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">s</span><span class="p">]))</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">tl</span> <span class="o">-</span> <span class="n">s</span> <span class="k">else</span>
                    <span class="p">((</span><span class="n">j</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">j</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">s</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">s</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tl</span><span class="p">)]</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">fd</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">fd</span></div>


<div class="viewcode-block" id="peaksimilarity"><a class="viewcode-back" href="../functions.html#functions.peaksimilarity">[docs]</a><span class="k">def</span> <span class="nf">peaksimilarity</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmm</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> 
                   <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Peak similarity&#39;</span><span class="p">):</span>    
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the similarity matrix as described in ´doi:10.1142/S021972001350011X´.</span>
<span class="sd">    It quantifyes the difference of the derivative function of the peaks and </span>
<span class="sd">    puts them into a matrix. This can be used for peak alignment.</span>
<span class="sd">   </span>
<span class="sd">    :type y1: list[float]</span>
<span class="sd">    :param y1: First vector to compare.</span>
<span class="sd">    </span>
<span class="sd">    :type y2: list[float]</span>
<span class="sd">    :param y2: Second vector to compare.</span>

<span class="sd">    :type p1: list[float]</span>
<span class="sd">    :param p1: List of peaks to compare from `y1`. It can be different in positions</span>
<span class="sd">        and length than `p2`.</span>
<span class="sd">        </span>
<span class="sd">    :type p2: list[float]</span>
<span class="sd">    :param p2: List of peaks to compare from `y2`. It can be different in positions</span>
<span class="sd">        and length than `p1`.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x axis. If ´None´, an axis will be created from 1..N, where N is</span>
<span class="sd">        the length of ´y1´. Default is `None.</span>
<span class="sd">    </span>
<span class="sd">    :type n: int</span>
<span class="sd">    :param n: size of the range to each side of the point to use to calculate </span>
<span class="sd">        the slope. Default is 5.</span>
<span class="sd">        </span>
<span class="sd">    :type plot: boolean</span>
<span class="sd">    :param plot: If true, plots the similarity matrix. Default is ´False´.</span>
<span class="sd">    </span>
<span class="sd">    :type cmm: string</span>
<span class="sd">    :param cmm: Color map for the plot. Default is ´inferno´.</span>
<span class="sd">    </span>
<span class="sd">    :type fontsize: int</span>
<span class="sd">    :param fontsize: Size of the font in the plot. Default is ´10´.</span>
<span class="sd">    </span>
<span class="sd">    :type title: string</span>
<span class="sd">    :param title: Title of the plot. Default is ´´.</span>
<span class="sd">    </span>
<span class="sd">    :returns: similarity matrix in the form of a 2-d list.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">))]</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">p2</span><span class="p">):</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">p2</span><span class="p">):</span>
        <span class="n">p2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>        
    
    <span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">]</span>

    <span class="n">peaks</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    
    <span class="n">sm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">max</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">]),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y2</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="p">]))))</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmm</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y2&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;y1&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">sm</span></div>
       

<div class="viewcode-block" id="reverse"><a class="viewcode-back" href="../functions.html#functions.reverse">[docs]</a><span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reverses a vector or a list of vectors.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: list of vectors to reverse. Single or multiple.</span>

<span class="sd">    :rtype: list[float]</span>
<span class="sd">    :returns: Reversed data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
    
    <span class="n">rev</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">rev</span> <span class="o">=</span> <span class="n">rev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">rev</span></div>


<div class="viewcode-block" id="count"><a class="viewcode-back" href="../functions.html#functions.count">[docs]</a><span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Counts the number of values that coincide with `value`.</span>
<span class="sd">    </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: vector or list of vectors to search for values.</span>
<span class="sd">    </span>
<span class="sd">    :type value: float</span>
<span class="sd">    :param value: Value or list of values to search in `y`. If many values are</span>
<span class="sd">        passed, then it returns a list with the counted equalities. Default is 0.</span>

<span class="sd">    :rtype: list[float]</span>
<span class="sd">    :returns: Reversed data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">dims_val</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">dims_y</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims_val</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        
    <span class="k">if</span> <span class="n">dims_y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
    
    <span class="n">count</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">dims_val</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">count</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">dims_y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">count</span></div>


<div class="viewcode-block" id="vectortoimg"><a class="viewcode-back" href="../functions.html#functions.vectortoimg">[docs]</a><span class="k">def</span> <span class="nf">vectortoimg</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">negatives</span><span class="o">=</span><span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="n">inverted</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms 1-D vecctors into an image. Useful for more insightful results</span>
<span class="sd">        when performing deep learning.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: vector or list of vectors.</span>

<span class="sd">    :type negatives: str</span>
<span class="sd">    :param negatives: Specify what to do with negative values. If `remove` then negative values are set to `0`. If</span>
<span class="sd">        `globalmin` then all the data is shifted up so the global minimum is `0`. Default it `remove`.</span>

<span class="sd">    :type inverted: boolean</span>
<span class="sd">    :param inverted: If `True`, inverts the process to take an image to a vector. Default is `False`.</span>

<span class="sd">    :rtype: list[list[list[int]]]</span>
<span class="sd">    :returns: 3-D list containing 0 or 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">y_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">y_dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

    <span class="n">gm</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">negatives</span> <span class="o">==</span> <span class="s1">&#39;globalmin&#39;</span><span class="p">:</span>
        <span class="n">gm</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">normtoglobalmax</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">globalmin</span><span class="o">=</span><span class="n">gm</span><span class="p">)</span>
    <span class="n">y_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">imgs</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_len</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_len</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_len</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">negatives</span> <span class="o">==</span> <span class="s1">&#39;remove&#39;</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.00</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">y_len</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.00</span>

    <span class="k">if</span> <span class="n">y_dims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">imgs</span> <span class="o">=</span> <span class="n">imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">imgs</span></div>


<div class="viewcode-block" id="deconvolution"><a class="viewcode-back" href="../functions.html#functions.deconvolution">[docs]</a><span class="k">def</span> <span class="nf">deconvolution</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;gauss&#39;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">look</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    BETA: Deconvolutes a spectra into a defined number of distributions. This will</span>
<span class="sd">        fit dsitributions on the declared positions `pos` of peaks and change </span>
<span class="sd">        their shape acoording to the difference betwwen the spectra and the </span>
<span class="sd">        sum (convoilution) of the fittings.</span>
<span class="sd">        </span>
<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param y: vector to deconvolute.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: axis.</span>
<span class="sd">    </span>
<span class="sd">    :type pos: list[float]</span>
<span class="sd">    :param pos: positions of peaks in x values </span>
<span class="sd">    </span>
<span class="sd">    :type method: string</span>
<span class="sd">    :param method: The selected shape of the fittings. Options include: `gauss`,</span>
<span class="sd">        `lorentz`, and `voigt`.</span>
<span class="sd">    </span>
<span class="sd">    :type pp: boolean</span>
<span class="sd">    :param pp: If `True`, it prints parameters of the fittings. Default</span>
<span class="sd">         is `False`.</span>
<span class="sd">         </span>
<span class="sd">    :rtype: list[list[float]]</span>
<span class="sd">    :returns: 2-D list of the fittings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">look</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">look</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">look</span> <span class="o">=</span> <span class="n">valtoind</span><span class="p">(</span><span class="n">look</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="p">]</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">gamma</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">]</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">x</span> <span class="c1"># x becomes the optimization variables</span>
    
    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;voigt&#39;</span><span class="p">:</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">voigtfit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gamma</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">],</span> <span class="n">manual</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;lorentz&#39;</span><span class="p">:</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lorentzfit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gamma</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">],</span> <span class="n">manual</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;gauss&#39;</span><span class="p">:</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gaussfit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">],</span> <span class="n">manual</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    
        <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">look</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">look</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fit</span><span class="p">)):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">fit</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">error</span> <span class="o">+=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="k">return</span> <span class="n">error</span><span class="o">**</span><span class="mf">0.5</span> 
    
    <span class="k">def</span> <span class="nf">constraint1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="c1"># is_zero=0</span>
        <span class="c1"># fit = []</span>
        <span class="c1"># for i in range(n):</span>
        <span class="c1">#     # fit.append(spep.voigtfit(x=ax, pos=pos[i], gamma=x[i], sigma=x[n+i], alpha=x[2*n+i], manual=True))</span>
        <span class="c1">#     # fit.append(spep.lorentzfit(x=ax, pos=pos[i], gamma=x[i], alpha=x[n+i], manual=True))</span>
        <span class="c1">#     fit.append(spep.gaussfit(x=ax, pos=x[i], sigma=x[i+n], alpha=x[2*n+i], manual=True))</span>
        
        <span class="c1"># for i in range(look[0], look[1]):</span>
        <span class="c1">#     s = 0</span>
        <span class="c1">#     for j in range(len(fit)):</span>
        <span class="c1">#         s += fit[j][i]</span>
        <span class="c1">#     return y[i]-s</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    
    <span class="n">initial</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bnds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">bnds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">shift</span><span class="p">])</span>
        <span class="n">initial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;voigt&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">bnds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">999</span><span class="p">])</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">bnds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">999</span><span class="p">])</span>
        <span class="n">initial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">bnds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">99999</span><span class="p">])</span>
        <span class="n">initial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>  <span class="c1"># master vector to optimize, initial values</span>
    <span class="n">con1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint1</span><span class="p">}</span>
    <span class="n">cons</span> <span class="o">=</span> <span class="p">([</span><span class="n">con1</span><span class="p">])</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">x</span>
    
    <span class="k">if</span> <span class="n">pp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;gauss&#39;</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">gaussfit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">],</span> <span class="n">manual</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;lorentz&#39;</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">lorentzfit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gamma</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">],</span> <span class="n">manual</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;voigt&#39;</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">voigtfit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gamma</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">],</span> <span class="n">manual</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>
            <span class="n">y0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>
    

<div class="viewcode-block" id="intersections"><a class="viewcode-back" href="../functions.html#functions.intersections">[docs]</a><span class="k">def</span> <span class="nf">intersections</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find approximate intersection points of two curves.</span>

<span class="sd">    :type y1: list[float]</span>
<span class="sd">    :param y1: first curve.</span>

<span class="sd">    :type y2: list[float]</span>
<span class="sd">    :param y2: second curve.</span>

<span class="sd">    :rtype: list[list[float]]</span>
<span class="sd">    :returns: coordinates of aproiximate intersecctions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">intersections</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Ensure both curves have the same length.</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y2</span><span class="p">),</span> <span class="s2">&quot;Both curves should have the same length.&quot;</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Check if y1[i] is below y2[i] and y1[i+1] is above y2[i+1] (indicating a crossing)</span>
        <span class="c1"># or if y1[i] is above y2[i] and y1[i+1] is below y2[i+1] (indicating another crossing)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y2</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y2</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">intersections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># Record the x-value where the intersection occurs.</span>
    
    <span class="k">return</span> <span class="n">intersections</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Institut de Recerca en Energia de Catalunya.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>